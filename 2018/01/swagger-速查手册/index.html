<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Swagger 速查手册 - Flow</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="子不语" /><meta name="description" content="第1章 简介 Swagger The World&amp;rsquo;s Most Popular Framework for APIs. Starting January 1st 2016 the Swagger Specification has been donated to the Open API Initiative (OAI) and is the foundation of the OpenAPI Specification. Swagger给人第一印象就是最流行，不懂Swagger咱就out" /><meta name="keywords" content="gitblog, blog, gitblog.me" />






<meta name="generator" content="Hugo 0.72.0 with theme even" />


<link rel="canonical" href="http://localhost:1313/2018/01/swagger-%E9%80%9F%E6%9F%A5%E6%89%8B%E5%86%8C/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.78f8f17bab244b9ee62ad16480c9584d5fc2db06ae20681d1ca225cefd80767c.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Swagger 速查手册" />
<meta property="og:description" content="第1章 简介 Swagger The World&rsquo;s Most Popular Framework for APIs. Starting January 1st 2016 the Swagger Specification has been donated to the Open API Initiative (OAI) and is the foundation of the OpenAPI Specification. Swagger给人第一印象就是最流行，不懂Swagger咱就out" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:1313/2018/01/swagger-%E9%80%9F%E6%9F%A5%E6%89%8B%E5%86%8C/" />
<meta property="article:published_time" content="2018-01-18T16:22:24+08:00" />
<meta property="article:modified_time" content="2019-09-05T16:50:35+08:00" />
<meta itemprop="name" content="Swagger 速查手册">
<meta itemprop="description" content="第1章 简介 Swagger The World&rsquo;s Most Popular Framework for APIs. Starting January 1st 2016 the Swagger Specification has been donated to the Open API Initiative (OAI) and is the foundation of the OpenAPI Specification. Swagger给人第一印象就是最流行，不懂Swagger咱就out">
<meta itemprop="datePublished" content="2018-01-18T16:22:24&#43;08:00" />
<meta itemprop="dateModified" content="2019-09-05T16:50:35&#43;08:00" />
<meta itemprop="wordCount" content="27617">



<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Swagger 速查手册"/>
<meta name="twitter:description" content="第1章 简介 Swagger The World&rsquo;s Most Popular Framework for APIs. Starting January 1st 2016 the Swagger Specification has been donated to the Open API Initiative (OAI) and is the foundation of the OpenAPI Specification. Swagger给人第一印象就是最流行，不懂Swagger咱就out"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Flow</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">首页</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">归档</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">标签</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Flow</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">首页</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">归档</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">标签</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Swagger 速查手册</h1>

      <div class="post-meta">
        <span class="post-time"> 2018-01-18 </span>
        
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#第1章-简介">第1章 简介</a>
      <ul>
        <li><a href="#swagger">Swagger</a></li>
        <li><a href="#openapi规范">OpenAPI规范</a></li>
        <li><a href="#为啥要使用openapi规范">为啥要使用OpenAPI规范？</a></li>
        <li><a href="#如何编写api文档">如何编写API文档？</a></li>
      </ul>
    </li>
    <li><a href="#第2章-从零开始">第2章 从零开始</a>
      <ul>
        <li><a href="#最简单的例子">最简单的例子</a></li>
        <li><a href="#定义一个api操作">定义一个API操作</a></li>
        <li><a href="#定义请求参数query-parameters">定义<code>请求参数</code>（query parameters）</a></li>
        <li><a href="#定义路径参数path-parameter">定义<code>路径参数</code>（path parameter）</a></li>
        <li><a href="#定义消息体参数body-parameter">定义<code>消息体参数</code>（body parameter）</a></li>
      </ul>
    </li>
    <li><a href="#第3章-文档瘦身">第3章 文档瘦身</a>
      <ul>
        <li><a href="#简化数据模型">简化数据模型</a></li>
        <li><a href="#简化响应消息">简化响应消息</a></li>
        <li><a href="#简化参数定义">简化参数定义</a></li>
      </ul>
    </li>
    <li><a href="#第4章-深入了解一下">第4章 深入了解一下</a>
      <ul>
        <li><a href="#私人定制">私人定制</a></li>
        <li><a href="#高级数据定义">高级数据定义</a></li>
      </ul>
    </li>
    <li><a href="#第5章-输入输出模型">第5章 输入输出模型</a>
      <ul>
        <li><a href="#高级参数定义">高级参数定义</a></li>
        <li><a href="#高级响应消息定义">高级响应消息定义</a></li>
        <li><a href="#定义某个参数只存在于响应消息中">定义某个参数只存在于响应消息中</a></li>
      </ul>
    </li>
    <li><a href="#第6章-不要让api裸奔">第6章 不要让API裸奔</a>
      <ul>
        <li><a href="#定义安全">定义安全</a></li>
        <li><a href="#使用安全定义">使用安全定义</a></li>
        <li><a href="#使用多种安全配置">使用多种安全配置</a></li>
      </ul>
    </li>
    <li><a href="#第7章-让文档的可读性更好">第7章 让文档的可读性更好</a>
      <ul>
        <li><a href="#分类标签tags">分类标签（Tags）</a></li>
        <li><a href="#无处不在的描述文字descriptions">无处不在的描述文字（Descriptions）</a></li>
        <li><a href="#在描述中使用markdown语法">在描述中使用Markdown语法</a></li>
        <li><a href="#示例数据examples">示例数据（Examples）</a></li>
        <li><a href="#标记为弃用">标记为弃用</a></li>
        <li><a href="#链接到外部文档">链接到外部文档</a></li>
      </ul>
    </li>
    <li><a href="#第8章-分而治之">第8章 分而治之</a>
      <ul>
        <li><a href="#json指针">JSON指针</a></li>
        <li><a href="#基础拆分">基础拆分</a></li>
        <li><a href="#引用本地文件">引用本地文件</a></li>
        <li><a href="#实战切分的思路">实战切分的思路</a></li>
      </ul>
    </li>
    <li><a href="#附录">附录</a></li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <h2 id="第1章-简介">第1章 简介</h2>
<h3 id="swagger">Swagger</h3>
<blockquote>
<p><strong>The World&rsquo;s Most Popular Framework for APIs.</strong></p>
<p><strong>Starting January 1st 2016 the Swagger Specification has been donated to the Open API Initiative (OAI) and is the foundation of the OpenAPI Specification.</strong></p>
</blockquote>
<p>Swagger给人第一印象就是最流行，不懂Swagger咱就out了。它的官方网站是<a href="http://swagger.io/">http://swagger.io/。</a></p>
<!-- raw HTML omitted -->
<p>Swagger是一个简单但功能强大的API表达工具。它具有地球上最大的API工具生态系统，数以千计的开发人员，使用几乎所有的现代编程语言，都在支持和使用Swagger。使用Swagger生成API，我们可以得到交互式文档，自动生成代码的SDK以及API的发现特性等。</p>
<p>现在，Swagger已经帮助包括Apigee, Getty图像, Intuit, LivingSocial, McKesson, 微软, Morningstar和PayPal等世界知名企业建立起了一套基于RESTful API的完美服务系统。</p>
<p>2.0版本已经发布，Swagger变得更加强大。值得感激的是，Swagger的源码100%开源在<a href="https://github.com/swagger-api">github</a>。</p>
<h3 id="openapi规范">OpenAPI规范</h3>
<p>OpenAPI规范是Linux基金会的一个项目，试图通过定义一种用来描述API格式或API定义的语言，来规范RESTful服务开发过程。OpenAPI规范帮助我们描述一个API的基本信息，比如：</p>
<ul>
<li>有关该API的一般性描述</li>
<li>可用路径（/资源）</li>
<li>在每个路径上的可用操作（获取/提交&hellip;）</li>
<li>每个操作的输入/输出格式</li>
</ul>
<p>目前<a href="https://github.com/OAI/OpenAPI-Specification/blob/master/versions/2.0.md">V2.0版本的OpenAPI规范</a>（也就是SwaggerV2.0规范）已经发布并开源在github上。该文档写的非常好，结构清晰，方便随时查阅。关于规范的学习和理解，本文最后还有个彩蛋。</p>
<h3 id="为啥要使用openapi规范">为啥要使用OpenAPI规范？</h3>
<ul>
<li>OpenAPI规范这类API定义语言能够帮助你更简单、快速的表述API，尤其是在API的设计阶段作用特别突出</li>
<li>根据OpenAPI规范编写的二进制文本文件，能够像代码一样用任何VCS工具管理起来</li>
<li>一旦编写完成，API文档可以作为：
<ul>
<li>需求和系统特性描述的根据</li>
<li>前后台查询、讨论、自测的基础</li>
<li>部分或者全部代码自动生成的根据</li>
<li>其他重要的作用，比如开放平台开发者的手册&hellip;</li>
</ul>
</li>
</ul>
<h3 id="如何编写api文档">如何编写API文档？</h3>
<h4 id="语言json-vs-yaml">语言：JSON vs YAML</h4>
<p>我们可以选择使用JSON或者YAML的语言格式来编写API文档。但是个人建议使用YAML来写，原因是<strong>它更简单</strong>。一图胜千言，先看用JSON写的文档：</p>
<div class="highlight"><pre class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
    <span class="nt">&#34;swagger&#34;</span><span class="p">:</span> <span class="s2">&#34;2.0&#34;</span><span class="p">,</span>
    <span class="nt">&#34;info&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;1.0.0&#34;</span><span class="p">,</span>
        <span class="nt">&#34;title&#34;</span><span class="p">:</span> <span class="s2">&#34;Simple API&#34;</span><span class="p">,</span>
        <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;A simple API to learn how to write OpenAPI Specification&#34;</span>
    <span class="p">},</span>
    <span class="nt">&#34;schemes&#34;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&#34;https&#34;</span>
    <span class="p">],</span>
    <span class="nt">&#34;host&#34;</span><span class="p">:</span> <span class="s2">&#34;simple.api&#34;</span><span class="p">,</span>
    <span class="nt">&#34;basePath&#34;</span><span class="p">:</span> <span class="s2">&#34;/openapi101&#34;</span><span class="p">,</span>
    <span class="nt">&#34;paths&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;/persons&#34;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&#34;get&#34;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&#34;summary&#34;</span><span class="p">:</span> <span class="s2">&#34;Gets some persons&#34;</span><span class="p">,</span>
                <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;Returns a list containing all persons.&#34;</span><span class="p">,</span>
                <span class="nt">&#34;responses&#34;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&#34;200&#34;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;A list of Person&#34;</span><span class="p">,</span>
                        <span class="nt">&#34;schema&#34;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;array&#34;</span><span class="p">,</span>
                            <span class="nt">&#34;items&#34;</span><span class="p">:</span> <span class="p">{</span>
                                <span class="nt">&#34;properties&#34;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&#34;firstName&#34;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;string&#34;</span>
                                    <span class="p">},</span>
                                    <span class="nt">&#34;lastName&#34;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;string&#34;</span>
                                    <span class="p">},</span>
                                    <span class="nt">&#34;username&#34;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;string&#34;</span>
                                    <span class="p">}</span>
                                <span class="p">}</span>
                            <span class="p">}</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div><p>再来看看同一份API文档的YAML实现：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">swagger</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;2.0&#34;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">info</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">version</span><span class="p">:</span><span class="w"> </span><span class="m">1.0.0</span><span class="w">
</span><span class="w">  </span><span class="k">title</span><span class="p">:</span><span class="w"> </span>Simple<span class="w"> </span>API<span class="w">
</span><span class="w">  </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>A<span class="w"> </span>simple<span class="w"> </span>API<span class="w"> </span>to<span class="w"> </span>learn<span class="w"> </span>how<span class="w"> </span>to<span class="w"> </span>write<span class="w"> </span>OpenAPI<span class="w"> </span>Specification<span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">schemes</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- https<span class="w">
</span><span class="w"></span><span class="k">host</span><span class="p">:</span><span class="w"> </span>simple.api<span class="w">
</span><span class="w"></span><span class="k">basePath</span><span class="p">:</span><span class="w"> </span>/openapi101<span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">paths</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">/persons</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">get</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">summary</span><span class="p">:</span><span class="w"> </span>Gets<span class="w"> </span>some<span class="w"> </span>persons<span class="w">
</span><span class="w">      </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Returns<span class="w"> </span>a<span class="w"> </span>list<span class="w"> </span>containing<span class="w"> </span>all<span class="w"> </span>persons.<span class="w">
</span><span class="w">      </span><span class="k">responses</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">200</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>A<span class="w"> </span>list<span class="w"> </span>of<span class="w"> </span>Person<span class="w">
</span><span class="w">          </span><span class="k">schema</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>array<span class="w">
</span><span class="w">            </span><span class="k">items</span><span class="p">:</span><span class="w">
</span><span class="w">              </span><span class="k">required</span><span class="p">:</span><span class="w">
</span><span class="w">                </span>- username<span class="w">
</span><span class="w">              </span><span class="k">properties</span><span class="p">:</span><span class="w">
</span><span class="w">                </span><span class="k">firstName</span><span class="p">:</span><span class="w">
</span><span class="w">                  </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">                </span><span class="k">lastName</span><span class="p">:</span><span class="w">
</span><span class="w">                  </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">                </span><span class="k">username</span><span class="p">:</span><span class="w">
</span><span class="w">                  </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">
</span></code></pre></div><p>对于普通人来说，似乎用YAML更能够简化书写和阅读。这里我们并没有非此即彼的选择问题，因为：</p>
<ul>
<li>几乎所用支持OpenAPI规范的工具都支持YAML</li>
<li>有很多的工具可以实现YAML-JSON之间的转换</li>
</ul>
<p>所以，用自己喜欢的方式书写即可。（后面的示例文档也都是用YAML来写的。强烈推荐使用YAML。）</p>
<h2 id="第2章-从零开始">第2章 从零开始</h2>
<p>这一章主要介绍API的基本组成部分，包括提供给API消费者（所有可能访问API的个体，下简称“消费者”）的的不同HTTP请求方法、路径，请求和消息体中的参数，以及返回给消费者的不同HTTP状态及响应消息体。</p>
<h3 id="最简单的例子">最简单的例子</h3>
<p>我们从一个最简单（几乎没有东西）的API文档开始：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">swagger</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;2.0&#34;</span><span class="w">
</span><span class="w"></span><span class="k">info</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">version</span><span class="p">:</span><span class="w"> </span><span class="m">1.0.0</span><span class="w">
</span><span class="w">  </span><span class="k">title</span><span class="p">:</span><span class="w"> </span>Simple<span class="w"> </span>API<span class="w">
</span><span class="w">  </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>A<span class="w"> </span>simple<span class="w"> </span>API<span class="w"> </span>to<span class="w"> </span>learn<span class="w"> </span>how<span class="w"> </span>to<span class="w"> </span>write<span class="w"> </span>OpenAPI<span class="w"> </span>Specification<span class="w">
</span><span class="w"></span><span class="k">schemes</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- https<span class="w">
</span><span class="w"></span><span class="k">host</span><span class="p">:</span><span class="w"> </span>simple.api<span class="w">
</span><span class="w"></span><span class="k">basePath</span><span class="p">:</span><span class="w"> </span>/openapi101<span class="w">
</span><span class="w"></span><span class="k">paths</span><span class="p">:</span><span class="w"> </span>{}<span class="w">
</span><span class="w">
</span></code></pre></div><p>这个文档的内容分成四部分，下面分别来说明。</p>
<h4 id="openapi规范的版本号">OpenAPI规范的版本号</h4>
<p>首先我们要通过一个<code>swagger</code>属性来声明OpenAPI规范的版本。</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">swagger</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;2.0&#34;</span><span class="w">
</span></code></pre></div><p>你没看错，是<code>swagger</code>，上面已经介绍了，OpenAPI规范是基于Swagger的，在未来的版本中，这个属性可能会换成<a href="https://github.com/OAI/OpenAPI-Specification/issues/561">别的</a>。 目前这个属性的值，暂时只能填写为<code>2.0</code>。</p>
<h4 id="api描述信息">API描述信息</h4>
<p>然后我们需要说明一下API文档的相关信息，比如API文档版本（注意不同于上面的规范版本）、API文档名称已经可选的描述信息。</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">info</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">version</span><span class="p">:</span><span class="w"> </span><span class="m">1.0.0</span><span class="w">
</span><span class="w">  </span><span class="k">title</span><span class="p">:</span><span class="w"> </span>Simple<span class="w"> </span>API<span class="w">
</span><span class="w">  </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>A<span class="w"> </span>simple<span class="w"> </span>API<span class="w"> </span>to<span class="w"> </span>learn<span class="w"> </span>how<span class="w"> </span>to<span class="w"> </span>write<span class="w"> </span>OpenAPI<span class="w"> </span>Specification<span class="w">
</span><span class="w">
</span></code></pre></div><h4 id="api的url">API的URL</h4>
<p>作为web API，一个很重要的信息就是用来给消费者使用的<code>根URL</code>，可以用协议（http或者https）、主机名、根路径来描述：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">schemes</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- https<span class="w">
</span><span class="w"></span><span class="k">host</span><span class="p">:</span><span class="w"> </span>simple.api<span class="w">
</span><span class="w"></span><span class="k">basePath</span><span class="p">:</span><span class="w"> </span>/openapi101<span class="w">
</span><span class="w">
</span></code></pre></div><p>这这个例子中，消费者把<code>https://simple.api/open101</code>作为根节点来访问各种API。因为和具体环境有关，不涉及API描述的根本内容，所以这部分信息是可选的。</p>
<h4 id="api的操作operation">API的操作（operation）</h4>
<p>这个例子中，我们没有写API的操作，用一个YAML的空对象<code>{}</code>先占个位置。</p>
<h3 id="定义一个api操作">定义一个API操作</h3>
<p>如果我们要展示一组用户信息，可以这样描述：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">swagger</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;2.0&#34;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">info</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">version</span><span class="p">:</span><span class="w"> </span><span class="m">1.0.0</span><span class="w">
</span><span class="w">  </span><span class="k">title</span><span class="p">:</span><span class="w"> </span>Simple<span class="w"> </span>API<span class="w">
</span><span class="w">  </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>A<span class="w"> </span>simple<span class="w"> </span>API<span class="w"> </span>to<span class="w"> </span>learn<span class="w"> </span>how<span class="w"> </span>to<span class="w"> </span>write<span class="w"> </span>OpenAPI<span class="w"> </span>Specification<span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">schemes</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- https<span class="w">
</span><span class="w"></span><span class="k">host</span><span class="p">:</span><span class="w"> </span>simple.api<span class="w">
</span><span class="w"></span><span class="k">basePath</span><span class="p">:</span><span class="w"> </span>/openapi101<span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">paths</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">/persons</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">get</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">summary</span><span class="p">:</span><span class="w"> </span>Gets<span class="w"> </span>some<span class="w"> </span>persons<span class="w">
</span><span class="w">      </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Returns<span class="w"> </span>a<span class="w"> </span>list<span class="w"> </span>containing<span class="w"> </span>all<span class="w"> </span>persons.<span class="w">
</span><span class="w">      </span><span class="k">responses</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">200</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>A<span class="w"> </span>list<span class="w"> </span>of<span class="w"> </span>Person<span class="w">
</span><span class="w">          </span><span class="k">schema</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>array<span class="w">
</span><span class="w">            </span><span class="k">items</span><span class="p">:</span><span class="w">
</span><span class="w">              </span><span class="k">required</span><span class="p">:</span><span class="w">
</span><span class="w">                </span>- username<span class="w">
</span><span class="w">              </span><span class="k">properties</span><span class="p">:</span><span class="w">
</span><span class="w">                </span><span class="k">firstName</span><span class="p">:</span><span class="w">
</span><span class="w">                  </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">                </span><span class="k">lastName</span><span class="p">:</span><span class="w">
</span><span class="w">                  </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">                </span><span class="k">username</span><span class="p">:</span><span class="w">
</span><span class="w">                  </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">
</span></code></pre></div><h4 id="添加一个路径path">添加一个<code>路径</code>（path）</h4>
<p>我们添加一个<code>/persons</code>的<code>路径</code>，用来访问一组用户信息：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">paths</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">/persons</span><span class="p">:</span><span class="w">
</span><span class="w">  
</span></code></pre></div><h4 id="在路径中添加一个http方法">在路径中添加一个HTTP方法</h4>
<p>在每个<code>路径</code>中，我们可以添加任意的<a href="https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol#Request_methods">HTTP动词</a>来操作所需要的资源。</p>
<p>比如需要展示一组用户信息，我们可以在<code>/persons</code>路径中添加<code>get</code>方法，同时还可以填写一些简单的描述信息（summary）或者说明该方法的一段长篇大论（description）。</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">    </span><span class="k">get</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">summary</span><span class="p">:</span><span class="w"> </span>Gets<span class="w"> </span>some<span class="w"> </span>persons<span class="w">
</span><span class="w">      </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Returns<span class="w"> </span>a<span class="w"> </span>list<span class="w"> </span>containing<span class="w"> </span>all<span class="w"> </span>persons.<span class="w">
</span><span class="w">
</span></code></pre></div><p>这样一来，我们调 <em>get <a href="https://simple.api/open101/persons">https://simple.api/open101/persons</a></em>方法就能获取所有用户信息列表了。</p>
<h4 id="定义响应response类型">定义<code>响应</code>（response）类型</h4>
<p>对于每个方法（或操作），我们都可以在<code>响应</code>(responses)中添加任意的<a href="https://en.wikipedia.org/wiki/List_of_HTTP_status_codes">HTTP状态码</a>（比如<em>200 OK</em> 或者 <em>404 Not Found</em>等）。这个例子中我们添加上<code>200</code>的响应：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">      </span><span class="k">responses</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">200</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>A<span class="w"> </span>list<span class="w"> </span>of<span class="w"> </span>Person<span class="w">
</span><span class="w">
</span></code></pre></div><h4 id="定义响应内容">定义响应内容</h4>
<p><em>get /persons</em>这个接口返回一组用户信息，我们通过响应消息中的<code>模式</code>（schema）属性来描述清楚具体的返回内容。</p>
<p>一组用户信息就是一个用户信息对象的<code>数组</code>（array），每一个数组元素则是一个用户信息<code>对象</code>（object），该对象包含三个string类型的属性：<code>姓氏</code>、<code>名字</code>、<code>用户名</code>，其中<code>用户名</code>必须提供（required）。</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">          </span><span class="k">schema</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>array<span class="w">
</span><span class="w">            </span><span class="k">items</span><span class="p">:</span><span class="w">
</span><span class="w">              </span><span class="k">required</span><span class="p">:</span><span class="w">
</span><span class="w">                </span>- username<span class="w">
</span><span class="w">              </span><span class="k">properties</span><span class="p">:</span><span class="w">
</span><span class="w">                </span><span class="k">firstName</span><span class="p">:</span><span class="w">
</span><span class="w">                  </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">                </span><span class="k">lastName</span><span class="p">:</span><span class="w">
</span><span class="w">                  </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">                </span><span class="k">username</span><span class="p">:</span><span class="w">
</span><span class="w">                  </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">
</span></code></pre></div><h3 id="定义请求参数query-parameters">定义<code>请求参数</code>（query parameters）</h3>
<p>用户太多，我们不想一股脑全部输出出来。这个时候，分页输出是个不错的选择，我们可以通过添加请求参数来实现。</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">swagger</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;2.0&#34;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">info</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">version</span><span class="p">:</span><span class="w"> </span><span class="m">1.0.0</span><span class="w">
</span><span class="w">  </span><span class="k">title</span><span class="p">:</span><span class="w"> </span>Simple<span class="w"> </span>API<span class="w">
</span><span class="w">  </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>A<span class="w"> </span>simple<span class="w"> </span>API<span class="w"> </span>to<span class="w"> </span>learn<span class="w"> </span>how<span class="w"> </span>to<span class="w"> </span>write<span class="w"> </span>OpenAPI<span class="w"> </span>Specification<span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">schemes</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- https<span class="w">
</span><span class="w"></span><span class="k">host</span><span class="p">:</span><span class="w"> </span>simple.api<span class="w">
</span><span class="w"></span><span class="k">basePath</span><span class="p">:</span><span class="w"> </span>/openapi101<span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">paths</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">/persons</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">get</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">summary</span><span class="p">:</span><span class="w"> </span>Gets<span class="w"> </span>some<span class="w"> </span>persons<span class="w">
</span><span class="w">      </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Returns<span class="w"> </span>a<span class="w"> </span>list<span class="w"> </span>containing<span class="w"> </span>all<span class="w"> </span>persons.<span class="w"> </span>The<span class="w"> </span>list<span class="w"> </span>supports<span class="w"> </span>paging.<span class="w">
</span><span class="w">      </span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">       </span>- <span class="k">name</span><span class="p">:</span><span class="w"> </span>pageSize<span class="w">
</span><span class="w">         </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>query<span class="w">
</span><span class="w">         </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Number<span class="w"> </span>of<span class="w"> </span>persons<span class="w"> </span>returned<span class="w">
</span><span class="w">         </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>integer<span class="w">
</span><span class="w">       </span>- <span class="k">name</span><span class="p">:</span><span class="w"> </span>pageNumber<span class="w">
</span><span class="w">         </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>query<span class="w">
</span><span class="w">         </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Page<span class="w"> </span>number<span class="w">
</span><span class="w">         </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>integer<span class="w">   
</span><span class="w">      </span><span class="k">responses</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">200</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>A<span class="w"> </span>list<span class="w"> </span>of<span class="w"> </span>Person<span class="w">
</span><span class="w">          </span><span class="k">schema</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>array<span class="w">
</span><span class="w">            </span><span class="k">items</span><span class="p">:</span><span class="w">
</span><span class="w">              </span><span class="k">required</span><span class="p">:</span><span class="w">
</span><span class="w">                </span>- username<span class="w">
</span><span class="w">              </span><span class="k">properties</span><span class="p">:</span><span class="w">
</span><span class="w">                </span><span class="k">firstName</span><span class="p">:</span><span class="w">
</span><span class="w">                  </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">                </span><span class="k">lastName</span><span class="p">:</span><span class="w">
</span><span class="w">                  </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">                </span><span class="k">username</span><span class="p">:</span><span class="w">
</span><span class="w">                  </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">
</span></code></pre></div><h4 id="在get方法中增加请求参数">在<em>get</em>方法中增加请求参数</h4>
<p>首先我们在 <em>get</em> 方法中增加一个<code>参数</code>属性：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">paths</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">/persons</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">get</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">summary</span><span class="p">:</span><span class="w"> </span>Gets<span class="w"> </span>some<span class="w"> </span>persons<span class="w">
</span><span class="w">      </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Returns<span class="w"> </span>a<span class="w"> </span>list<span class="w"> </span>containing<span class="w"> </span>all<span class="w"> </span>persons.<span class="w"> </span>The<span class="w"> </span>list<span class="w"> </span>supports<span class="w"> </span>paging.<span class="w">
</span><span class="w">      </span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span></code></pre></div><h4 id="添加分页参数">添加分页参数</h4>
<p>在参数列表中，我们添加两个名字（name）分别叫做<code>pageSize</code>和<code>pageNumber</code>的整型（integer）参数，并作简单描述：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">      </span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">       </span>- <span class="k">name</span><span class="p">:</span><span class="w"> </span>pageSize<span class="w">
</span><span class="w">         </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>query<span class="w">
</span><span class="w">         </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Number<span class="w"> </span>of<span class="w"> </span>persons<span class="w"> </span>returned<span class="w">
</span><span class="w">         </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>integer<span class="w">
</span><span class="w">       </span>- <span class="k">name</span><span class="p">:</span><span class="w"> </span>pageNumber<span class="w">
</span><span class="w">         </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>query<span class="w">
</span><span class="w">         </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Page<span class="w"> </span>number<span class="w">
</span><span class="w">         </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>integer<span class="w">
</span><span class="w">      </span><span class="k">responses</span><span class="p">:</span><span class="w">
</span><span class="w">
</span></code></pre></div><p>这样一来，消费者就可以通过 <em>get /persons?pageSize=20&amp;pageNumber=2</em> 来访问第2页的用户信息（不超过20条）了。</p>
<h3 id="定义路径参数path-parameter">定义<code>路径参数</code>（path parameter）</h3>
<p>有时候我们想要根据用户名来查找用户信息，这时我们需要增加一个接口操作，比如可以添加一个类似 <em>/persons/{username}</em> 的操作来获取用户信息。注意，<em>{username}</em> 是在请求路径中的参数。</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">swagger</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;2.0&#34;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">info</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">version</span><span class="p">:</span><span class="w"> </span><span class="m">1.0.0</span><span class="w">
</span><span class="w">  </span><span class="k">title</span><span class="p">:</span><span class="w"> </span>Simple<span class="w"> </span>API<span class="w">
</span><span class="w">  </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>A<span class="w"> </span>simple<span class="w"> </span>API<span class="w"> </span>to<span class="w"> </span>learn<span class="w"> </span>how<span class="w"> </span>to<span class="w"> </span>write<span class="w"> </span>OpenAPI<span class="w"> </span>Specification<span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">schemes</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- https<span class="w">
</span><span class="w"></span><span class="k">host</span><span class="p">:</span><span class="w"> </span>simple.api<span class="w">
</span><span class="w"></span><span class="k">basePath</span><span class="p">:</span><span class="w"> </span>/openapi101<span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">paths</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">/persons</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">get</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">summary</span><span class="p">:</span><span class="w"> </span>Gets<span class="w"> </span>some<span class="w"> </span>persons<span class="w">
</span><span class="w">      </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Returns<span class="w"> </span>a<span class="w"> </span>list<span class="w"> </span>containing<span class="w"> </span>all<span class="w"> </span>persons.<span class="w"> </span>The<span class="w"> </span>list<span class="w"> </span>supports<span class="w"> </span>paging.<span class="w">
</span><span class="w">      </span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">       </span>- <span class="k">name</span><span class="p">:</span><span class="w"> </span>pageSize<span class="w">
</span><span class="w">         </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>query<span class="w">
</span><span class="w">         </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Number<span class="w"> </span>of<span class="w"> </span>persons<span class="w"> </span>returned<span class="w">
</span><span class="w">         </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>integer<span class="w">
</span><span class="w">       </span>- <span class="k">name</span><span class="p">:</span><span class="w"> </span>pageNumber<span class="w">
</span><span class="w">         </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>query<span class="w">
</span><span class="w">         </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Page<span class="w"> </span>number<span class="w">
</span><span class="w">         </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>integer<span class="w">
</span><span class="w">      </span><span class="k">responses</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">200</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>A<span class="w"> </span>list<span class="w"> </span>of<span class="w"> </span>Person<span class="w">
</span><span class="w">          </span><span class="k">schema</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>array<span class="w">
</span><span class="w">            </span><span class="k">items</span><span class="p">:</span><span class="w">
</span><span class="w">              </span><span class="k">required</span><span class="p">:</span><span class="w">
</span><span class="w">                </span>- username<span class="w">
</span><span class="w">              </span><span class="k">properties</span><span class="p">:</span><span class="w">
</span><span class="w">                </span><span class="k">firstName</span><span class="p">:</span><span class="w">
</span><span class="w">                  </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">                </span><span class="k">lastName</span><span class="p">:</span><span class="w">
</span><span class="w">                  </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">                </span><span class="k">username</span><span class="p">:</span><span class="w">
</span><span class="w">                  </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">  </span>/persons/{<span class="k">username}</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">get</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">summary</span><span class="p">:</span><span class="w"> </span>Gets<span class="w"> </span>a<span class="w"> </span>person<span class="w">
</span><span class="w">      </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Returns<span class="w"> </span>a<span class="w"> </span>single<span class="w"> </span>person<span class="w"> </span>for<span class="w"> </span>its<span class="w"> </span>username<span class="w">
</span><span class="w">      </span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">        </span>- <span class="k">name</span><span class="p">:</span><span class="w"> </span>username<span class="w">
</span><span class="w">          </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>path<span class="w">
</span><span class="w">          </span><span class="k">required</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;The person&#39;s username&#34;</span><span class="w">
</span><span class="w">          </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">      </span><span class="k">responses</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">200</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>A<span class="w"> </span>Person<span class="w">
</span><span class="w">          </span><span class="k">schema</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="k">required</span><span class="p">:</span><span class="w">
</span><span class="w">              </span>- username<span class="w">
</span><span class="w">            </span><span class="k">properties</span><span class="p">:</span><span class="w">
</span><span class="w">              </span><span class="k">firstName</span><span class="p">:</span><span class="w">
</span><span class="w">                </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">              </span><span class="k">lastName</span><span class="p">:</span><span class="w">
</span><span class="w">                </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">              </span><span class="k">username</span><span class="p">:</span><span class="w">
</span><span class="w">                </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">        </span><span class="k">404</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>The<span class="w"> </span>Person<span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exists.<span class="w">
</span><span class="w">
</span></code></pre></div><h4 id="添加一个-get-personsusername-操作">添加一个 <em>get /persons/{username}</em> 操作</h4>
<p>首先我们在 <em>/persons</em> 路径后面，增加一个 <em>/persons/{username}</em> 的路径，并定义一个 <em>get</em> （操作）方法。</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">swagger</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;2.0&#34;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">info</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">version</span><span class="p">:</span><span class="w"> </span><span class="m">1.0.0</span><span class="w">
</span><span class="w">  </span><span class="k">title</span><span class="p">:</span><span class="w"> </span>Simple<span class="w"> </span>API<span class="w">
</span><span class="w">  </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>A<span class="w"> </span>simple<span class="w"> </span>API<span class="w"> </span>to<span class="w"> </span>learn<span class="w"> </span>how<span class="w"> </span>to<span class="w"> </span>write<span class="w"> </span>OpenAPI<span class="w"> </span>Specification<span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">schemes</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- https<span class="w">
</span><span class="w"></span><span class="k">host</span><span class="p">:</span><span class="w"> </span>simple.api<span class="w">
</span><span class="w"></span><span class="k">basePath</span><span class="p">:</span><span class="w"> </span>/openapi101<span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">paths</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">/persons</span><span class="p">:</span><span class="w">
</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">  </span>/persons/{<span class="k">username}</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">get</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">summary</span><span class="p">:</span><span class="w"> </span>Gets<span class="w"> </span>a<span class="w"> </span>person<span class="w">
</span><span class="w">      </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Returns<span class="w"> </span>a<span class="w"> </span>single<span class="w"> </span>person<span class="w"> </span>for<span class="w"> </span>its<span class="w"> </span>username<span class="w">
</span><span class="w">
</span></code></pre></div><h4 id="定义路径参数-username">定义路径参数 <em>username</em></h4>
<p>因为 <em>{username}</em> 是路径参数，我们需要先像请求参数一样将它添加到 <em>parameters</em> 属性中，注意名称应该同上面大括号（ <em>{ }</em> ） 里面的名称一致。并通过 <code>in</code> 这个属性，来表示它是一个路径（path）参数。</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">      </span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">        </span>- <span class="k">name</span><span class="p">:</span><span class="w"> </span>username<span class="w">
</span><span class="w">          </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>path<span class="w">
</span><span class="w">          </span><span class="k">required</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>The<span class="w"> </span>person&#39;s<span class="w"> </span>username<span class="w">
</span><span class="w">          </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">
</span></code></pre></div><p>定义路径参数时很容易出现的问题就是忘记：<code>required: true</code>，Swagger的自动完成功能中没有包含这个属性定义。 如果没有写 <em>require</em> 属性，默认值是 <strong>false</strong>，也就是说 <em>username</em> 参数时可选的。可事实上，作为路径参数，它是必需的。</p>
<h4 id="定义响应消息">定义响应消息</h4>
<p>别忘了获取单个用户信息也需要填写 <em>200</em> 响应消息，响应消息体的内容就是之前描述过的用户信息（用户信息列表中的一个元素）：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">      </span><span class="k">responses</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">200</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>A<span class="w"> </span>Person<span class="w">
</span><span class="w">          </span><span class="k">schema</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="k">required</span><span class="p">:</span><span class="w">
</span><span class="w">              </span>- username<span class="w">
</span><span class="w">            </span><span class="k">properties</span><span class="p">:</span><span class="w">
</span><span class="w">              </span><span class="k">firstName</span><span class="p">:</span><span class="w">
</span><span class="w">                </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">              </span><span class="k">lastName</span><span class="p">:</span><span class="w">
</span><span class="w">                </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">              </span><span class="k">username</span><span class="p">:</span><span class="w">
</span><span class="w">                </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">
</span></code></pre></div><p>当然，API的提供者会对 <em>username</em> 进行校验，如果查无此人，应该返回 <em>404</em> 的异常状态。所以我们再加上 <em>404</em> 状态的响应：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">        </span><span class="k">404</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>The<span class="w"> </span>Person<span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exists.<span class="w">
</span><span class="w">
</span></code></pre></div><h3 id="定义消息体参数body-parameter">定义<code>消息体参数</code>（body parameter）</h3>
<p>当我们需要添加一个用户信息时，我们需要一个能够提供 <em>post  /persons</em> 的API操作。</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">swagger</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;2.0&#34;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">info</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">version</span><span class="p">:</span><span class="w"> </span><span class="m">1.0.0</span><span class="w">
</span><span class="w">  </span><span class="k">title</span><span class="p">:</span><span class="w"> </span>Simple<span class="w"> </span>API<span class="w">
</span><span class="w">  </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>A<span class="w"> </span>simple<span class="w"> </span>API<span class="w"> </span>to<span class="w"> </span>learn<span class="w"> </span>how<span class="w"> </span>to<span class="w"> </span>write<span class="w"> </span>OpenAPI<span class="w"> </span>Specification<span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">schemes</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- https<span class="w">
</span><span class="w"></span><span class="k">host</span><span class="p">:</span><span class="w"> </span>simple.api<span class="w">
</span><span class="w"></span><span class="k">basePath</span><span class="p">:</span><span class="w"> </span>/openapi101<span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">paths</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">/persons</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">get</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">summary</span><span class="p">:</span><span class="w"> </span>Gets<span class="w"> </span>some<span class="w"> </span>persons<span class="w">
</span><span class="w">      </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Returns<span class="w"> </span>a<span class="w"> </span>list<span class="w"> </span>containing<span class="w"> </span>all<span class="w"> </span>persons.<span class="w"> </span>The<span class="w"> </span>list<span class="w"> </span>supports<span class="w"> </span>paging.<span class="w">
</span><span class="w">      </span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">       </span>- <span class="k">name</span><span class="p">:</span><span class="w"> </span>pageSize<span class="w">
</span><span class="w">         </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>query<span class="w">
</span><span class="w">         </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Number<span class="w"> </span>of<span class="w"> </span>persons<span class="w"> </span>returned<span class="w">
</span><span class="w">         </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>integer<span class="w">
</span><span class="w">       </span>- <span class="k">name</span><span class="p">:</span><span class="w"> </span>pageNumber<span class="w">
</span><span class="w">         </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>query<span class="w">
</span><span class="w">         </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Page<span class="w"> </span>number<span class="w">
</span><span class="w">         </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>integer<span class="w">
</span><span class="w">      </span><span class="k">responses</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">200</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>A<span class="w"> </span>list<span class="w"> </span>of<span class="w"> </span>Person<span class="w">
</span><span class="w">          </span><span class="k">schema</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>array<span class="w">
</span><span class="w">            </span><span class="k">items</span><span class="p">:</span><span class="w">
</span><span class="w">              </span><span class="k">required</span><span class="p">:</span><span class="w">
</span><span class="w">                </span>- username<span class="w">
</span><span class="w">              </span><span class="k">properties</span><span class="p">:</span><span class="w">
</span><span class="w">                </span><span class="k">firstName</span><span class="p">:</span><span class="w">
</span><span class="w">                  </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">                </span><span class="k">lastName</span><span class="p">:</span><span class="w">
</span><span class="w">                  </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">                </span><span class="k">username</span><span class="p">:</span><span class="w">
</span><span class="w">                  </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">    </span><span class="k">post</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">summary</span><span class="p">:</span><span class="w"> </span>Creates<span class="w"> </span>a<span class="w"> </span>person<span class="w">
</span><span class="w">      </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Adds<span class="w"> </span>a<span class="w"> </span>new<span class="w"> </span>person<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>persons<span class="w"> </span>list.<span class="w">
</span><span class="w">      </span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">        </span>- <span class="k">name</span><span class="p">:</span><span class="w"> </span>person<span class="w">
</span><span class="w">          </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>body<span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>The<span class="w"> </span>person<span class="w"> </span>to<span class="w"> </span>create.<span class="w">
</span><span class="w">          </span><span class="k">schema</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="k">required</span><span class="p">:</span><span class="w">
</span><span class="w">              </span>- username<span class="w">
</span><span class="w">            </span><span class="k">properties</span><span class="p">:</span><span class="w">
</span><span class="w">              </span><span class="k">firstName</span><span class="p">:</span><span class="w">
</span><span class="w">                </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">              </span><span class="k">lastName</span><span class="p">:</span><span class="w">
</span><span class="w">                </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">              </span><span class="k">username</span><span class="p">:</span><span class="w">
</span><span class="w">                </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">      </span><span class="k">responses</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">204</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Persons<span class="w"> </span>succesfully<span class="w"> </span>created.<span class="w">
</span><span class="w">        </span><span class="k">400</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Persons<span class="w"> </span>couldn<span class="s1">&#39;t have been created.
</span><span class="s1">  /persons/{username}:
</span><span class="s1">    get:
</span><span class="s1">      summary: Gets a person
</span><span class="s1">      description: Returns a single person for its username.
</span><span class="s1">      parameters:
</span><span class="s1">        - name: username
</span><span class="s1">          in: path
</span><span class="s1">          required: true
</span><span class="s1">          description: The person&#39;</span>s<span class="w"> </span>username<span class="w">
</span><span class="w">          </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">      </span><span class="k">responses</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">200</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>A<span class="w"> </span>Person<span class="w">
</span><span class="w">          </span><span class="k">schema</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="k">required</span><span class="p">:</span><span class="w">
</span><span class="w">              </span>- username<span class="w">
</span><span class="w">            </span><span class="k">properties</span><span class="p">:</span><span class="w">
</span><span class="w">              </span><span class="k">firstName</span><span class="p">:</span><span class="w">
</span><span class="w">                </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">              </span><span class="k">lastName</span><span class="p">:</span><span class="w">
</span><span class="w">                </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">              </span><span class="k">username</span><span class="p">:</span><span class="w">
</span><span class="w">                </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">         </span><span class="k">404</span><span class="p">:</span><span class="w">
</span><span class="w">           </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>The<span class="w"> </span>Person<span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exists.<span class="w">
</span><span class="w">
</span></code></pre></div><h4 id="添加一个-post-persons-操作">添加一个 <em>post /persons</em> 操作</h4>
<p>首先在 <em>/persons</em> 路径下廷加一个 <em>post</em> 操作：</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">paths:
  /persons:

</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">    post:
      summary: Creates a person
      description: Adds a new person to the persons list.

</code></pre></div><h4 id="定义消息体参数">定义消息体参数</h4>
<p>接下来我们给 <em>post</em> 方法添加参数，通过 <code>in</code> 属性显式说明参数是在 <em>body</em> 中的。参数的定义参考 <em>get /persons/{username}</em> 的 <em>200</em> 响应消息体参数，也就是包含用户的姓氏、名字、用户名。</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">      </span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">        </span>- <span class="k">name</span><span class="p">:</span><span class="w"> </span>person<span class="w">
</span><span class="w">          </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>body<span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>The<span class="w"> </span>person<span class="w"> </span>to<span class="w"> </span>create.<span class="w">
</span><span class="w">          </span><span class="k">schema</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="k">required</span><span class="p">:</span><span class="w">
</span><span class="w">              </span>- username<span class="w">
</span><span class="w">            </span><span class="k">properties</span><span class="p">:</span><span class="w">
</span><span class="w">              </span><span class="k">firstName</span><span class="p">:</span><span class="w">
</span><span class="w">                </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">              </span><span class="k">lastName</span><span class="p">:</span><span class="w">
</span><span class="w">                </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">              </span><span class="k">username</span><span class="p">:</span><span class="w">
</span><span class="w">                </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">
</span></code></pre></div><h4 id="定义响应消息-1">定义响应消息</h4>
<p>最后不要忘记定义 <em>post</em> 操作的响应消息。</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">      responses:
        204:
          description: Persons succesfully created.
        400:
          description: Persons couldn&#39;t have been created.

</code></pre></div><hr>
<h2 id="第3章-文档瘦身">第3章 文档瘦身</h2>
<p>现在我们已经学会了编写API文档的基本方法。不过上面的例子中存在一些重复，这对于程序员的嗅觉来说，就是代码的“坏味道”。这一章我们一起学习如何通过抽取可重用的定义（definitions）来简化API文档。</p>
<h3 id="简化数据模型">简化数据模型</h3>
<p>我们认真观察第2章最后输出的API文档，很容易发现 <em>Person</em> 的定义出现了三次，非常的不 <code>DRY</code>☹。</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">swagger</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;2.0&#34;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">info</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">version</span><span class="p">:</span><span class="w"> </span><span class="m">1.0.0</span><span class="w">
</span><span class="w">  </span><span class="k">title</span><span class="p">:</span><span class="w"> </span>Simple<span class="w"> </span>API<span class="w">
</span><span class="w">  </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>A<span class="w"> </span>simple<span class="w"> </span>API<span class="w"> </span>to<span class="w"> </span>learn<span class="w"> </span>how<span class="w"> </span>to<span class="w"> </span>write<span class="w"> </span>OpenAPI<span class="w"> </span>Specification<span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">schemes</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- https<span class="w">
</span><span class="w"></span><span class="k">host</span><span class="p">:</span><span class="w"> </span>simple.api<span class="w">
</span><span class="w"></span><span class="k">basePath</span><span class="p">:</span><span class="w"> </span>/openapi101<span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">paths</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">/persons</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">get</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">summary</span><span class="p">:</span><span class="w"> </span>Gets<span class="w"> </span>some<span class="w"> </span>persons<span class="w">
</span><span class="w">      </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Returns<span class="w"> </span>a<span class="w"> </span>list<span class="w"> </span>containing<span class="w"> </span>all<span class="w"> </span>persons.<span class="w"> </span>The<span class="w"> </span>list<span class="w"> </span>supports<span class="w"> </span>paging.<span class="w">
</span><span class="w">      </span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">       </span>- <span class="k">name</span><span class="p">:</span><span class="w"> </span>pageSize<span class="w">
</span><span class="w">         </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>query<span class="w">
</span><span class="w">         </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Number<span class="w"> </span>of<span class="w"> </span>persons<span class="w"> </span>returned<span class="w">
</span><span class="w">         </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>integer<span class="w">
</span><span class="w">       </span>- <span class="k">name</span><span class="p">:</span><span class="w"> </span>pageNumber<span class="w">
</span><span class="w">         </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>query<span class="w">
</span><span class="w">         </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Page<span class="w"> </span>number<span class="w">
</span><span class="w">         </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>integer<span class="w">
</span><span class="w">      </span><span class="k">responses</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">200</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>A<span class="w"> </span>list<span class="w"> </span>of<span class="w"> </span>Person<span class="w">
</span><span class="w">          </span><span class="k">schema</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>array<span class="w">
</span><span class="w">            </span><span class="k">items</span><span class="p">:</span><span class="w">
</span><span class="w"></span><span class="c">#START 第1次定义</span><span class="w">
</span><span class="w">              </span><span class="k">required</span><span class="p">:</span><span class="w">
</span><span class="w">                </span>- username<span class="w">
</span><span class="w">              </span><span class="k">properties</span><span class="p">:</span><span class="w">
</span><span class="w">                </span><span class="k">firstName</span><span class="p">:</span><span class="w">
</span><span class="w">                  </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">                </span><span class="k">lastName</span><span class="p">:</span><span class="w">
</span><span class="w">                  </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">                </span><span class="k">username</span><span class="p">:</span><span class="w">
</span><span class="w">                  </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w"></span><span class="c"># END  第1次定义</span><span class="w">
</span><span class="w">    </span><span class="k">post</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">summary</span><span class="p">:</span><span class="w"> </span>Creates<span class="w"> </span>a<span class="w"> </span>person<span class="w">
</span><span class="w">      </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Adds<span class="w"> </span>a<span class="w"> </span>new<span class="w"> </span>person<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>persons<span class="w"> </span>list.<span class="w">
</span><span class="w">      </span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">        </span>- <span class="k">name</span><span class="p">:</span><span class="w"> </span>person<span class="w">
</span><span class="w">          </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>body<span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>The<span class="w"> </span>person<span class="w"> </span>to<span class="w"> </span>create.<span class="w">
</span><span class="w">          </span><span class="k">schema</span><span class="p">:</span><span class="w">
</span><span class="w"></span><span class="c">#START 第2次定义</span><span class="w">
</span><span class="w">            </span><span class="k">required</span><span class="p">:</span><span class="w">
</span><span class="w">              </span>- username<span class="w">
</span><span class="w">            </span><span class="k">properties</span><span class="p">:</span><span class="w">
</span><span class="w">              </span><span class="k">firstName</span><span class="p">:</span><span class="w">
</span><span class="w">                </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">              </span><span class="k">lastName</span><span class="p">:</span><span class="w">
</span><span class="w">                </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">              </span><span class="k">username</span><span class="p">:</span><span class="w">
</span><span class="w">                </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w"></span><span class="c"># END  第2次定义</span><span class="w">
</span><span class="w">      </span><span class="k">responses</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">204</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Persons<span class="w"> </span>succesfully<span class="w"> </span>created.<span class="w">
</span><span class="w">        </span><span class="k">400</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Persons<span class="w"> </span>couldn<span class="s1">&#39;t have been created.
</span><span class="s1">  /persons/{username}:
</span><span class="s1">    get:
</span><span class="s1">      summary: Gets a person
</span><span class="s1">      description: Returns a single person for its username.
</span><span class="s1">      parameters:
</span><span class="s1">        - name: username
</span><span class="s1">          in: path
</span><span class="s1">          required: true
</span><span class="s1">          description: The person&#39;</span>s<span class="w"> </span>username<span class="w">
</span><span class="w">          </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">      </span><span class="k">responses</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">200</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>A<span class="w"> </span>Person<span class="w">
</span><span class="w">          </span><span class="k">schema</span><span class="p">:</span><span class="w">
</span><span class="w"></span><span class="c">#START 第3次定义</span><span class="w">
</span><span class="w">            </span><span class="k">required</span><span class="p">:</span><span class="w">
</span><span class="w">              </span>- username<span class="w">
</span><span class="w">            </span><span class="k">properties</span><span class="p">:</span><span class="w">
</span><span class="w">              </span><span class="k">firstName</span><span class="p">:</span><span class="w">
</span><span class="w">                </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">              </span><span class="k">lastName</span><span class="p">:</span><span class="w">
</span><span class="w">                </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">              </span><span class="k">username</span><span class="p">:</span><span class="w">
</span><span class="w">                </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w"></span><span class="c"># END  第3次定义</span><span class="w">
</span><span class="w">        </span><span class="k">404</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>The<span class="w"> </span>Person<span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exists.<span class="w">
</span><span class="w">
</span></code></pre></div><p>现在，我们通过可重用的<code>定义</code> （definition）来重构这个文档：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">swagger</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;2.0&#34;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">info</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">version</span><span class="p">:</span><span class="w"> </span><span class="m">1.0.0</span><span class="w">
</span><span class="w">  </span><span class="k">title</span><span class="p">:</span><span class="w"> </span>Simple<span class="w"> </span>API<span class="w">
</span><span class="w">  </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>A<span class="w"> </span>simple<span class="w"> </span>API<span class="w"> </span>to<span class="w"> </span>learn<span class="w"> </span>how<span class="w"> </span>to<span class="w"> </span>write<span class="w"> </span>OpenAPI<span class="w"> </span>Specification<span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">schemes</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- https<span class="w">
</span><span class="w"></span><span class="k">host</span><span class="p">:</span><span class="w"> </span>simple.api<span class="w">
</span><span class="w"></span><span class="k">basePath</span><span class="p">:</span><span class="w"> </span>/openapi101<span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">paths</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">/persons</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">get</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">summary</span><span class="p">:</span><span class="w"> </span>Gets<span class="w"> </span>some<span class="w"> </span>persons<span class="w">
</span><span class="w">      </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Returns<span class="w"> </span>a<span class="w"> </span>list<span class="w"> </span>containing<span class="w"> </span>all<span class="w"> </span>persons.<span class="w"> </span>The<span class="w"> </span>list<span class="w"> </span>supports<span class="w"> </span>paging.<span class="w">
</span><span class="w">      </span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">       </span>- <span class="k">name</span><span class="p">:</span><span class="w"> </span>pageSize<span class="w">
</span><span class="w">         </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>query<span class="w">
</span><span class="w">         </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Number<span class="w"> </span>of<span class="w"> </span>persons<span class="w"> </span>returned<span class="w">
</span><span class="w">         </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>integer<span class="w">
</span><span class="w">       </span>- <span class="k">name</span><span class="p">:</span><span class="w"> </span>pageNumber<span class="w">
</span><span class="w">         </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>query<span class="w">
</span><span class="w">         </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Page<span class="w"> </span>number<span class="w">
</span><span class="w">         </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>integer<span class="w">
</span><span class="w">      </span><span class="k">responses</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">200</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>A<span class="w"> </span>list<span class="w"> </span>of<span class="w"> </span>Person<span class="w">
</span><span class="w">          </span><span class="k">schema</span><span class="p">:</span><span class="w">
</span><span class="w"></span><span class="c">#START 替换成引用</span><span class="w">
</span><span class="w">            </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#/definitions/Persons&#34;</span><span class="w">
</span><span class="w"></span><span class="c"># END </span><span class="w">
</span><span class="w">    </span><span class="k">post</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">summary</span><span class="p">:</span><span class="w"> </span>Creates<span class="w"> </span>a<span class="w"> </span>person<span class="w">
</span><span class="w">      </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Adds<span class="w"> </span>a<span class="w"> </span>new<span class="w"> </span>person<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>persons<span class="w"> </span>list.<span class="w">
</span><span class="w">      </span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">        </span>- <span class="k">name</span><span class="p">:</span><span class="w"> </span>person<span class="w">
</span><span class="w">          </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>body<span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>The<span class="w"> </span>person<span class="w"> </span>to<span class="w"> </span>create.<span class="w">
</span><span class="w">          </span><span class="k">schema</span><span class="p">:</span><span class="w">
</span><span class="w"></span><span class="c">#START 替换成引用</span><span class="w">
</span><span class="w">            </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#/definitions/Person&#34;</span><span class="w">
</span><span class="w"></span><span class="c"># END </span><span class="w">
</span><span class="w">      </span><span class="k">responses</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">204</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Persons<span class="w"> </span>succesfully<span class="w"> </span>created.<span class="w">
</span><span class="w">        </span><span class="k">400</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Persons<span class="w"> </span>couldn<span class="s1">&#39;t have been created.
</span><span class="s1">  /persons/{username}:
</span><span class="s1">    get:
</span><span class="s1">      summary: Gets a person
</span><span class="s1">      description: Returns a single person for its username.
</span><span class="s1">      parameters:
</span><span class="s1">        - name: username
</span><span class="s1">          in: path
</span><span class="s1">          required: true
</span><span class="s1">          description: The person&#39;</span>s<span class="w"> </span>username<span class="w">
</span><span class="w">          </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">      </span><span class="k">responses</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">200</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>A<span class="w"> </span>Person<span class="w">
</span><span class="w">          </span><span class="k">schema</span><span class="p">:</span><span class="w">
</span><span class="w"></span><span class="c">#START 替换成引用</span><span class="w">
</span><span class="w">            </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#/definitions/Person&#34;</span><span class="w">
</span><span class="w"></span><span class="c"># END </span><span class="w">
</span><span class="w">        </span><span class="k">404</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>The<span class="w"> </span>Person<span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exists.<span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c">#START 新增定义</span><span class="w">
</span><span class="w"></span><span class="k">definitions</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">Person</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">required</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- username<span class="w">
</span><span class="w">    </span><span class="k">properties</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">firstName</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">      </span><span class="k">lastName</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">      </span><span class="k">username</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">  </span><span class="k">Persons</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>array<span class="w">
</span><span class="w">    </span><span class="k">items</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#/definitions/Person&#34;</span><span class="w">
</span><span class="w"></span><span class="c"># END 新增定义</span><span class="w">
</span><span class="w">
</span></code></pre></div><p>文档简化了很多。这得益于<a href="https://github.com/OAI/OpenAPI-Specification/blob/master/versions/2.0.md#swaggerObject">OpenAPI规范中关于定义（definition）的章节中</a>允许我们“一处定义，处处使用”。</p>
<h4 id="添加定义-definitions项">添加<code>定义</code> （definitions）项</h4>
<p>我们首先在API文档的尾部添加一个<code>定义</code> （definitions）项（其实它也可以放在文档的任意位置，只不过大家习惯放在文档末尾）：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">        </span><span class="k">404</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>The<span class="w"> </span>Person<span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exists.<span class="w">
</span><span class="w"></span><span class="k">definitions</span><span class="p">:</span><span class="w">
</span><span class="w">
</span></code></pre></div><h4 id="增加一个可重用的对象定义">增加一个可重用的（对象）<code>定义</code></h4>
<p>然后我们增加一个 <em>Person</em> 对象的定义：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">definitions</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">Person</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">required</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- username<span class="w">
</span><span class="w">    </span><span class="k">properties</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">firstName</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">      </span><span class="k">lastName</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">      </span><span class="k">username</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">
</span></code></pre></div><h4 id="引用一个定义来增加另一个定义">引用一个<code>定义</code>来增加另一个<code>定义</code></h4>
<p>在定义项中，我们可以立即引用刚才定义好的 <em>Person</em> 来增加另一个<code>定义</code>，<em>Persons</em>。<em>Persons</em> 是一个 <em>Person</em> 对象的数组。与之前直接定义的不同之处是，我们增加了一个<code>引用</code>（<em>reference</em>）属性，也就是 <em>$ref</em> 来引用 <em>Person</em> 。</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">  </span><span class="k">Persons</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>array<span class="w">
</span><span class="w">    </span><span class="k">items</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#/definitions/Person&#34;</span><span class="w">
</span><span class="w">
</span></code></pre></div><h4 id="在响应消息中使用定义">在响应消息中使用<code>定义</code></h4>
<p>一旦定义好了 <em>Person</em> ，我们可以把原来在响应消息中相应的定义字段替换掉。</p>
<h5 id="getpersons">get/persons</h5>
<p>原来：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">      </span><span class="k">responses</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">200</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>A<span class="w"> </span>list<span class="w"> </span>of<span class="w"> </span>Person<span class="w">
</span><span class="w">          </span><span class="k">schema</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>array<span class="w">
</span><span class="w">            </span><span class="k">items</span><span class="p">:</span><span class="w">
</span><span class="w">              </span><span class="k">required</span><span class="p">:</span><span class="w">
</span><span class="w">                </span>- username<span class="w">
</span><span class="w">              </span><span class="k">properties</span><span class="p">:</span><span class="w">
</span><span class="w">                </span><span class="k">firstName</span><span class="p">:</span><span class="w">
</span><span class="w">                  </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">                </span><span class="k">lastName</span><span class="p">:</span><span class="w">
</span><span class="w">                  </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">
</span></code></pre></div><p>现在：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">      </span><span class="k">responses</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">200</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>A<span class="w"> </span>list<span class="w"> </span>of<span class="w"> </span>Person<span class="w">
</span><span class="w">          </span><span class="k">schema</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#/definitions/Persons&#34;</span><span class="w">
</span><span class="w">
</span></code></pre></div><h5 id="getpersonsusername">get/persons/{username}</h5>
<p>原来：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">      </span><span class="k">responses</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">200</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>A<span class="w"> </span>Person<span class="w">
</span><span class="w">          </span><span class="k">schema</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="k">required</span><span class="p">:</span><span class="w">
</span><span class="w">              </span>- username<span class="w">
</span><span class="w">            </span><span class="k">properties</span><span class="p">:</span><span class="w">
</span><span class="w">              </span><span class="k">firstName</span><span class="p">:</span><span class="w">
</span><span class="w">                </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">              </span><span class="k">lastName</span><span class="p">:</span><span class="w">
</span><span class="w">                </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">              </span><span class="k">username</span><span class="p">:</span><span class="w">
</span><span class="w">                </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">
</span></code></pre></div><p>现在：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">      </span><span class="k">responses</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">200</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>A<span class="w"> </span>Person<span class="w">
</span><span class="w">          </span><span class="k">schema</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#/definitions/Person&#34;</span><span class="w">
</span><span class="w">
</span></code></pre></div><h4 id="在参数中使用定义">在参数中使用<code>定义</code></h4>
<p>不仅仅在消息中可以使用<code>定义</code>，在参数中也可以使用。</p>
<h5 id="post-persons">post /persons</h5>
<p>原来：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">    </span><span class="k">post</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">summary</span><span class="p">:</span><span class="w"> </span>Creates<span class="w"> </span>a<span class="w"> </span>person<span class="w">
</span><span class="w">      </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Adds<span class="w"> </span>a<span class="w"> </span>new<span class="w"> </span>person<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>persons<span class="w"> </span>list.<span class="w">
</span><span class="w">      </span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">        </span>- <span class="k">name</span><span class="p">:</span><span class="w"> </span>person<span class="w">
</span><span class="w">          </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>body<span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>The<span class="w"> </span>person<span class="w"> </span>to<span class="w"> </span>create.<span class="w">
</span><span class="w">          </span><span class="k">schema</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="k">required</span><span class="p">:</span><span class="w">
</span><span class="w">              </span>- username<span class="w">
</span><span class="w">            </span><span class="k">properties</span><span class="p">:</span><span class="w">
</span><span class="w">              </span><span class="k">firstName</span><span class="p">:</span><span class="w">
</span><span class="w">                </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">              </span><span class="k">lastName</span><span class="p">:</span><span class="w">
</span><span class="w">                </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">              </span><span class="k">username</span><span class="p">:</span><span class="w">
</span><span class="w">                </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">
</span></code></pre></div><p>现在：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">    </span><span class="k">post</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">summary</span><span class="p">:</span><span class="w"> </span>Creates<span class="w"> </span>a<span class="w"> </span>person<span class="w">
</span><span class="w">      </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Adds<span class="w"> </span>a<span class="w"> </span>new<span class="w"> </span>person<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>persons<span class="w"> </span>list.<span class="w">
</span><span class="w">      </span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">        </span>- <span class="k">name</span><span class="p">:</span><span class="w"> </span>person<span class="w">
</span><span class="w">          </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>body<span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>The<span class="w"> </span>person<span class="w"> </span>to<span class="w"> </span>create.<span class="w">
</span><span class="w">          </span><span class="k">schema</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#/definitions/Person&#34;</span><span class="w">
</span><span class="w">
</span></code></pre></div><h3 id="简化响应消息">简化响应消息</h3>
<p>我们看到了<code>引用</code> （<em>$ref</em>）的作用，接下来我们再把它用到响应消息的定义中：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">swagger</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;2.0&#34;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">info</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">version</span><span class="p">:</span><span class="w"> </span><span class="m">1.0.0</span><span class="w">
</span><span class="w">  </span><span class="k">title</span><span class="p">:</span><span class="w"> </span>Simple<span class="w"> </span>API<span class="w">
</span><span class="w">  </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>A<span class="w"> </span>simple<span class="w"> </span>API<span class="w"> </span>to<span class="w"> </span>learn<span class="w"> </span>how<span class="w"> </span>to<span class="w"> </span>write<span class="w"> </span>OpenAPI<span class="w"> </span>Specification<span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">schemes</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- https<span class="w">
</span><span class="w"></span><span class="k">host</span><span class="p">:</span><span class="w"> </span>simple.api<span class="w">
</span><span class="w"></span><span class="k">basePath</span><span class="p">:</span><span class="w"> </span>/openapi101<span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">paths</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">/persons</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">get</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">summary</span><span class="p">:</span><span class="w"> </span>Gets<span class="w"> </span>some<span class="w"> </span>persons<span class="w">
</span><span class="w">      </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Returns<span class="w"> </span>a<span class="w"> </span>list<span class="w"> </span>containing<span class="w"> </span>all<span class="w"> </span>persons.<span class="w"> </span>The<span class="w"> </span>list<span class="w"> </span>supports<span class="w"> </span>paging.<span class="w">
</span><span class="w">      </span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">       </span>- <span class="k">name</span><span class="p">:</span><span class="w"> </span>pageSize<span class="w">
</span><span class="w">         </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>query<span class="w">
</span><span class="w">         </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Number<span class="w"> </span>of<span class="w"> </span>persons<span class="w"> </span>returned<span class="w">
</span><span class="w">         </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>integer<span class="w">
</span><span class="w">       </span>- <span class="k">name</span><span class="p">:</span><span class="w"> </span>pageNumber<span class="w">
</span><span class="w">         </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>query<span class="w">
</span><span class="w">         </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Page<span class="w"> </span>number<span class="w">
</span><span class="w">         </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>integer<span class="w">
</span><span class="w">      </span><span class="k">responses</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">200</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>A<span class="w"> </span>list<span class="w"> </span>of<span class="w"> </span>Person<span class="w">
</span><span class="w">          </span><span class="k">schema</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#/definitions/Persons&#34;</span><span class="w">
</span><span class="w">        </span><span class="k">500</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#/responses/Standard500ErrorResponse&#34;</span><span class="w">
</span><span class="w">    </span><span class="k">post</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">summary</span><span class="p">:</span><span class="w"> </span>Creates<span class="w"> </span>a<span class="w"> </span>person<span class="w">
</span><span class="w">      </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Adds<span class="w"> </span>a<span class="w"> </span>new<span class="w"> </span>person<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>persons<span class="w"> </span>list.<span class="w">
</span><span class="w">      </span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">        </span>- <span class="k">name</span><span class="p">:</span><span class="w"> </span>person<span class="w">
</span><span class="w">          </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>body<span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>The<span class="w"> </span>person<span class="w"> </span>to<span class="w"> </span>create.<span class="w">
</span><span class="w">          </span><span class="k">schema</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#/definitions/Person&#34;</span><span class="w">
</span><span class="w">      </span><span class="k">responses</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">204</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Persons<span class="w"> </span>succesfully<span class="w"> </span>created.<span class="w">
</span><span class="w">        </span><span class="k">400</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Persons<span class="w"> </span>couldn<span class="s1">&#39;t have been created.
</span><span class="s1">        500:
</span><span class="s1">          $ref: &#34;#/responses/Standard500ErrorResponse&#34;
</span><span class="s1">
</span><span class="s1">  /persons/{username}:
</span><span class="s1">    get:
</span><span class="s1">      summary: Gets a person
</span><span class="s1">      description: Returns a single person for its username.
</span><span class="s1">      parameters:
</span><span class="s1">        - name: username
</span><span class="s1">          in: path
</span><span class="s1">          required: true
</span><span class="s1">          description: The person&#39;</span>s<span class="w"> </span>username<span class="w">
</span><span class="w">          </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">      </span><span class="k">responses</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">200</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>A<span class="w"> </span>Person<span class="w">
</span><span class="w">          </span><span class="k">schema</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#/definitions/Person&#34;</span><span class="w">
</span><span class="w">        </span><span class="k">404</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>The<span class="w"> </span>Person<span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exists.<span class="w">
</span><span class="w">        </span><span class="k">500</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#/responses/Standard500ErrorResponse&#34;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">definitions</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">Person</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">required</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- username<span class="w">
</span><span class="w">    </span><span class="k">properties</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">firstName</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">      </span><span class="k">lastName</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">      </span><span class="k">username</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">  </span><span class="k">Persons</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>array<span class="w">
</span><span class="w">    </span><span class="k">items</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#/definitions/Person&#34;</span><span class="w">
</span><span class="w">  </span><span class="k">Error</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">properties</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">code</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">      </span><span class="k">message</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">responses</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">Standard500ErrorResponse</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>An<span class="w"> </span>unexpected<span class="w"> </span>error<span class="w"> </span>occured.<span class="w">
</span><span class="w">    </span><span class="k">schema</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#/definitions/Error&#34;</span><span class="w">
</span><span class="w">
</span></code></pre></div><h4 id="定义可重用的http-500-响应">定义可重用的HTTP 500 响应</h4>
<p>发生HTTP 500错误时，假如我们希望每一个API操作都返回一个带有错误码（error code）和描述信息（message）的响应，我们可以这样做：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">paths</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">/persons</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">get</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">summary</span><span class="p">:</span><span class="w"> </span>Gets<span class="w"> </span>some<span class="w"> </span>persons<span class="w">
</span><span class="w">      </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Returns<span class="w"> </span>a<span class="w"> </span>list<span class="w"> </span>containing<span class="w"> </span>all<span class="w"> </span>persons.<span class="w"> </span>The<span class="w"> </span>list<span class="w"> </span>supports<span class="w"> </span>paging.<span class="w">
</span><span class="w">      </span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">       </span>- <span class="k">name</span><span class="p">:</span><span class="w"> </span>pageSize<span class="w">
</span><span class="w">         </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>query<span class="w">
</span><span class="w">         </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Number<span class="w"> </span>of<span class="w"> </span>persons<span class="w"> </span>returned<span class="w">
</span><span class="w">         </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>integer<span class="w">
</span><span class="w">       </span>- <span class="k">name</span><span class="p">:</span><span class="w"> </span>pageNumber<span class="w">
</span><span class="w">         </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>query<span class="w">
</span><span class="w">         </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Page<span class="w"> </span>number<span class="w">
</span><span class="w">         </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>integer<span class="w">
</span><span class="w">      </span><span class="k">responses</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">200</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>A<span class="w"> </span>list<span class="w"> </span>of<span class="w"> </span>Person<span class="w">
</span><span class="w">          </span><span class="k">schema</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#/definitions/Persons&#34;</span><span class="w">
</span><span class="w">        </span><span class="k">500</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>An<span class="w"> </span>unexpected<span class="w"> </span>error<span class="w"> </span>occured.<span class="w">
</span><span class="w">          </span><span class="k">schema</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="k">properties</span><span class="p">:</span><span class="w">
</span><span class="w">              </span><span class="k">code</span><span class="p">:</span><span class="w">
</span><span class="w">                </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">              </span><span class="k">message</span><span class="p">:</span><span class="w">
</span><span class="w">                </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">    </span><span class="k">post</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">summary</span><span class="p">:</span><span class="w"> </span>Creates<span class="w"> </span>a<span class="w"> </span>person<span class="w">
</span><span class="w">      </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Adds<span class="w"> </span>a<span class="w"> </span>new<span class="w"> </span>person<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>persons<span class="w"> </span>list.<span class="w">
</span><span class="w">      </span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">        </span>- <span class="k">name</span><span class="p">:</span><span class="w"> </span>person<span class="w">
</span><span class="w">          </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>body<span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>The<span class="w"> </span>person<span class="w"> </span>to<span class="w"> </span>create.<span class="w">
</span><span class="w">          </span><span class="k">schema</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#/definitions/Person&#34;</span><span class="w">
</span><span class="w">      </span><span class="k">responses</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">204</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Persons<span class="w"> </span>succesfully<span class="w"> </span>created.<span class="w">
</span><span class="w">        </span><span class="k">400</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Persons<span class="w"> </span>couldn<span class="s1">&#39;t have been created.
</span><span class="s1">        500:
</span><span class="s1">          description: An unexpected error occured.
</span><span class="s1">          schema:
</span><span class="s1">            properties:
</span><span class="s1">              code:
</span><span class="s1">                type: string
</span><span class="s1">              message:
</span><span class="s1">                type: string
</span><span class="s1">
</span><span class="s1">  /persons/{username}:
</span><span class="s1">    get:
</span><span class="s1">      summary: Gets a person
</span><span class="s1">      description: Returns a single person for its username.
</span><span class="s1">      parameters:
</span><span class="s1">        - name: username
</span><span class="s1">          in: path
</span><span class="s1">          required: true
</span><span class="s1">          description: The person&#39;</span>s<span class="w"> </span>username<span class="w">
</span><span class="w">          </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">      </span><span class="k">responses</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">200</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>A<span class="w"> </span>Person<span class="w">
</span><span class="w">          </span><span class="k">schema</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#/definitions/Person&#34;</span><span class="w">
</span><span class="w">        </span><span class="k">404</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>The<span class="w"> </span>Person<span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exists.<span class="w">
</span><span class="w">        </span><span class="k">500</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>An<span class="w"> </span>unexpected<span class="w"> </span>error<span class="w"> </span>occured.<span class="w">
</span><span class="w">          </span><span class="k">schema</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="k">properties</span><span class="p">:</span><span class="w">
</span><span class="w">              </span><span class="k">code</span><span class="p">:</span><span class="w">
</span><span class="w">                </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">              </span><span class="k">message</span><span class="p">:</span><span class="w">
</span><span class="w">                </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">
</span></code></pre></div><h4 id="增加一个error定义">增加一个Error定义</h4>
<p>按照“一处定义、处处引用”的原则，我们可以在定义项中增加 <em>Error</em> 的定义：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">definitions</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">Person</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">required</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- username<span class="w">
</span><span class="w">    </span><span class="k">properties</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">firstName</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">      </span><span class="k">lastName</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">      </span><span class="k">username</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">  </span><span class="k">Persons</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>array<span class="w">
</span><span class="w">    </span><span class="k">items</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#/definitions/Person&#34;</span><span class="w">
</span><span class="w">  </span><span class="k">Error</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">properties</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">code</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">      </span><span class="k">message</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">
</span></code></pre></div><p>而且我们也学会了使用<code>引用</code>（<em>$ref</em>），所以我们可以这样写：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">paths</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">/persons</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">get</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">summary</span><span class="p">:</span><span class="w"> </span>Gets<span class="w"> </span>some<span class="w"> </span>persons<span class="w">
</span><span class="w">      </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Returns<span class="w"> </span>a<span class="w"> </span>list<span class="w"> </span>containing<span class="w"> </span>all<span class="w"> </span>persons.<span class="w"> </span>The<span class="w"> </span>list<span class="w"> </span>supports<span class="w"> </span>paging.<span class="w">
</span><span class="w">      </span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">       </span>- <span class="k">name</span><span class="p">:</span><span class="w"> </span>pageSize<span class="w">
</span><span class="w">         </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>query<span class="w">
</span><span class="w">         </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Number<span class="w"> </span>of<span class="w"> </span>persons<span class="w"> </span>returned<span class="w">
</span><span class="w">         </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>integer<span class="w">
</span><span class="w">       </span>- <span class="k">name</span><span class="p">:</span><span class="w"> </span>pageNumber<span class="w">
</span><span class="w">         </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>query<span class="w">
</span><span class="w">         </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Page<span class="w"> </span>number<span class="w">
</span><span class="w">         </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>integer<span class="w">
</span><span class="w">      </span><span class="k">responses</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">200</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>A<span class="w"> </span>list<span class="w"> </span>of<span class="w"> </span>Person<span class="w">
</span><span class="w">          </span><span class="k">schema</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#/definitions/Persons&#34;</span><span class="w">
</span><span class="w">        </span><span class="k">500</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>An<span class="w"> </span>unexpected<span class="w"> </span>error<span class="w"> </span>occured.<span class="w">
</span><span class="w">          </span><span class="k">schema</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#/definitions/Error&#34;</span><span class="w">
</span><span class="w">    </span><span class="k">post</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">summary</span><span class="p">:</span><span class="w"> </span>Creates<span class="w"> </span>a<span class="w"> </span>person<span class="w">
</span><span class="w">      </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Adds<span class="w"> </span>a<span class="w"> </span>new<span class="w"> </span>person<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>persons<span class="w"> </span>list.<span class="w">
</span><span class="w">      </span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">        </span>- <span class="k">name</span><span class="p">:</span><span class="w"> </span>person<span class="w">
</span><span class="w">          </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>body<span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>The<span class="w"> </span>person<span class="w"> </span>to<span class="w"> </span>create.<span class="w">
</span><span class="w">          </span><span class="k">schema</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#/definitions/Person&#34;</span><span class="w">
</span><span class="w">      </span><span class="k">responses</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">204</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Persons<span class="w"> </span>succesfully<span class="w"> </span>created.<span class="w">
</span><span class="w">        </span><span class="k">400</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Persons<span class="w"> </span>couldn<span class="s1">&#39;t have been created.
</span><span class="s1">        500:
</span><span class="s1">          description: An unexpected error occured.
</span><span class="s1">          schema:
</span><span class="s1">            $ref: &#34;#/definitions/Error&#34;   
</span><span class="s1">  /persons/{username}:
</span><span class="s1">    get:
</span><span class="s1">      summary: Gets a person
</span><span class="s1">      description: Returns a single person for its username.
</span><span class="s1">      parameters:
</span><span class="s1">        - name: username
</span><span class="s1">          in: path
</span><span class="s1">          required: true
</span><span class="s1">          description: The person&#39;</span>s<span class="w"> </span>username<span class="w">
</span><span class="w">          </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">      </span><span class="k">responses</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">200</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>A<span class="w"> </span>Person<span class="w">
</span><span class="w">          </span><span class="k">schema</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#/definitions/Person&#34;</span><span class="w">
</span><span class="w">        </span><span class="k">404</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>The<span class="w"> </span>Person<span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exists.<span class="w">
</span><span class="w">        </span><span class="k">500</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>An<span class="w"> </span>unexpected<span class="w"> </span>error<span class="w"> </span>occured.<span class="w">
</span><span class="w">          </span><span class="k">schema</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#/definitions/Error&#34;</span><span class="w">
</span><span class="w">
</span></code></pre></div><h4 id="定义一个可重用的响应消息">定义一个可重用的响应消息</h4>
<p>上面的文档中，还是有一些重复的内容。我们可以根据OpenAPI规范中的<a href="https://github.com/OAI/OpenAPI-Specification/blob/master/versions/2.0.md#swaggerObject">responses</a>章节的描述，通过定义一个可重用的响应消息，来进一步简化文档。</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">definitions</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">Person</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">required</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- username<span class="w">
</span><span class="w">    </span><span class="k">properties</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">firstName</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">      </span><span class="k">lastName</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">      </span><span class="k">username</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">  </span><span class="k">Persons</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>array<span class="w">
</span><span class="w">    </span><span class="k">items</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#/definitions/Person&#34;</span><span class="w">
</span><span class="w">  </span><span class="k">Error</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">properties</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">code</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">      </span><span class="k">message</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w"></span><span class="k">responses</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">Standard500ErrorResponse</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>An<span class="w"> </span>unexpected<span class="w"> </span>error<span class="w"> </span>occured.<span class="w">
</span><span class="w">    </span><span class="k">schema</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#/definitions/Error&#34;</span><span class="w">
</span><span class="w">
</span></code></pre></div><p>注意：响应消息中引用了 <em>Error</em> 的定义。</p>
<h4 id="使用已定义的响应消息">使用已定义的响应消息</h4>
<p>我们还是通过<code>引用</code>（<em>$ref</em>）来使用一个已经定义好的响应消息，比如：</p>
<h5 id="get-users">get /users</h5>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">      </span><span class="k">responses</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">200</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>A<span class="w"> </span>list<span class="w"> </span>of<span class="w"> </span>Person<span class="w">
</span><span class="w">          </span><span class="k">schema</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#/definitions/Persons&#34;</span><span class="w">
</span><span class="w">        </span><span class="k">500</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#/responses/Standard500ErrorResponse&#34;</span><span class="w">
</span><span class="w">
</span></code></pre></div><h5 id="postusers">post/users</h5>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">      </span><span class="k">responses</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">204</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Persons<span class="w"> </span>succesfully<span class="w"> </span>created.<span class="w">
</span><span class="w">        </span><span class="k">400</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Persons<span class="w"> </span>couldn&#39;t<span class="w"> </span>have<span class="w"> </span>been<span class="w"> </span>created.<span class="w">
</span><span class="w">        </span><span class="k">500</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#/responses/Standard500ErrorResponse&#34;</span><span class="w">
</span><span class="w">
</span></code></pre></div><h5 id="getusersusername">get/users/{username}</h5>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">      </span><span class="k">responses</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">200</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>A<span class="w"> </span>Person<span class="w">
</span><span class="w">          </span><span class="k">schema</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#/definitions/Person&#34;</span><span class="w">
</span><span class="w">        </span><span class="k">404</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>The<span class="w"> </span>Person<span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exists.<span class="w">
</span><span class="w">        </span><span class="k">500</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#/responses/Standard500ErrorResponse&#34;</span><span class="w">
</span><span class="w">
</span></code></pre></div><h3 id="简化参数定义">简化参数定义</h3>
<p>类似数据模型、响应消息的简化，参数定义的简化也很容易。</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">swagger</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;2.0&#34;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">info</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">version</span><span class="p">:</span><span class="w"> </span><span class="m">1.0.0</span><span class="w">
</span><span class="w">  </span><span class="k">title</span><span class="p">:</span><span class="w"> </span>Simple<span class="w"> </span>API<span class="w">
</span><span class="w">  </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>A<span class="w"> </span>simple<span class="w"> </span>API<span class="w"> </span>to<span class="w"> </span>learn<span class="w"> </span>how<span class="w"> </span>to<span class="w"> </span>write<span class="w"> </span>OpenAPI<span class="w"> </span>Specification<span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">schemes</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- https<span class="w">
</span><span class="w"></span><span class="k">host</span><span class="p">:</span><span class="w"> </span>simple.api<span class="w">
</span><span class="w"></span><span class="k">basePath</span><span class="p">:</span><span class="w"> </span>/openapi101<span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">paths</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">/persons</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">get</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">summary</span><span class="p">:</span><span class="w"> </span>Gets<span class="w"> </span>some<span class="w"> </span>persons<span class="w">
</span><span class="w">      </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Returns<span class="w"> </span>a<span class="w"> </span>list<span class="w"> </span>containing<span class="w"> </span>all<span class="w"> </span>persons.<span class="w"> </span>The<span class="w"> </span>list<span class="w"> </span>supports<span class="w"> </span>paging.<span class="w">
</span><span class="w">      </span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">       </span>- <span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#/parameters/pageSize&#34;</span><span class="w">
</span><span class="w">       </span>- <span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#/parameters/pageNumber&#34;</span><span class="w">
</span><span class="w">      </span><span class="k">responses</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">200</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>A<span class="w"> </span>list<span class="w"> </span>of<span class="w"> </span>Person<span class="w">
</span><span class="w">          </span><span class="k">schema</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#/definitions/Persons&#34;</span><span class="w">
</span><span class="w">        </span><span class="k">500</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#/responses/Standard500ErrorResponse&#34;</span><span class="w">
</span><span class="w">    </span><span class="k">post</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">summary</span><span class="p">:</span><span class="w"> </span>Creates<span class="w"> </span>a<span class="w"> </span>person<span class="w">
</span><span class="w">      </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Adds<span class="w"> </span>a<span class="w"> </span>new<span class="w"> </span>person<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>persons<span class="w"> </span>list.<span class="w">
</span><span class="w">      </span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">        </span>- <span class="k">name</span><span class="p">:</span><span class="w"> </span>person<span class="w">
</span><span class="w">          </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>body<span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>The<span class="w"> </span>person<span class="w"> </span>to<span class="w"> </span>create.<span class="w">
</span><span class="w">          </span><span class="k">schema</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#/definitions/Person&#34;</span><span class="w">
</span><span class="w">      </span><span class="k">responses</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">204</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Person<span class="w"> </span>succesfully<span class="w"> </span>created.<span class="w">
</span><span class="w">        </span><span class="k">400</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Person<span class="w"> </span>couldn<span class="s1">&#39;t have been created.
</span><span class="s1">        500:
</span><span class="s1">          $ref: &#34;#/responses/Standard500ErrorResponse&#34;
</span><span class="s1">
</span><span class="s1">  /persons/{username}:
</span><span class="s1">    parameters:
</span><span class="s1">      - $ref: &#34;#/parameters/username&#34;
</span><span class="s1">    get:
</span><span class="s1">      summary: Gets a person
</span><span class="s1">      description: Returns a single person for its username.
</span><span class="s1">      responses:
</span><span class="s1">        200:
</span><span class="s1">          description: A Person
</span><span class="s1">          schema:
</span><span class="s1">            $ref: &#34;#/definitions/Person&#34;
</span><span class="s1">        404:
</span><span class="s1">          $ref: &#34;#/responses/PersonDoesNotExistResponse&#34;
</span><span class="s1">        500:
</span><span class="s1">          $ref: &#34;#/responses/Standard500ErrorResponse&#34;
</span><span class="s1">    delete:
</span><span class="s1">      summary: Deletes a person
</span><span class="s1">      description: Delete a single person identified via its username
</span><span class="s1">      responses:
</span><span class="s1">        204:
</span><span class="s1">          description: Person successfully deleted.
</span><span class="s1">        404:
</span><span class="s1">          $ref: &#34;#/responses/PersonDoesNotExistResponse&#34;
</span><span class="s1">        500:
</span><span class="s1">          $ref: &#34;#/responses/Standard500ErrorResponse&#34;
</span><span class="s1">
</span><span class="s1">  /persons/{username}/friends:
</span><span class="s1">    parameters:
</span><span class="s1">      - $ref: &#34;#/parameters/username&#34;
</span><span class="s1">    get:
</span><span class="s1">      summary: Gets a person&#39;</span>s<span class="w"> </span>friends<span class="w">
</span><span class="w">      </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Returns<span class="w"> </span>a<span class="w"> </span>list<span class="w"> </span>containing<span class="w"> </span>all<span class="w"> </span>persons.<span class="w"> </span>The<span class="w"> </span>list<span class="w"> </span>supports<span class="w"> </span>paging.<span class="w">
</span><span class="w">      </span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">       </span>- <span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#/parameters/pageSize&#34;</span><span class="w">
</span><span class="w">       </span>- <span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#/parameters/pageNumber&#34;</span><span class="w">
</span><span class="w">      </span><span class="k">responses</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">200</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>A<span class="w"> </span>person<span class="s1">&#39;s friends list 
</span><span class="s1">          schema:
</span><span class="s1">            $ref: &#34;#/definitions/Persons&#34;
</span><span class="s1">        404:
</span><span class="s1">          $ref: &#34;#/responses/PersonDoesNotExistResponse&#34;
</span><span class="s1">        500:
</span><span class="s1">          $ref: &#34;#/responses/Standard500ErrorResponse&#34;
</span><span class="s1">
</span><span class="s1">definitions:
</span><span class="s1">  Person:
</span><span class="s1">    required:
</span><span class="s1">      - username
</span><span class="s1">    properties:
</span><span class="s1">      firstName:
</span><span class="s1">        type: string
</span><span class="s1">      lastName:
</span><span class="s1">        type: string
</span><span class="s1">      username:
</span><span class="s1">        type: string
</span><span class="s1">  Persons:
</span><span class="s1">    type: array
</span><span class="s1">    items:
</span><span class="s1">      $ref: &#34;#/definitions/Person&#34;
</span><span class="s1">  Error:
</span><span class="s1">    required:
</span><span class="s1">      - code
</span><span class="s1">      - message
</span><span class="s1">    properties:
</span><span class="s1">      code:
</span><span class="s1">        type: string
</span><span class="s1">      message:
</span><span class="s1">        type: string
</span><span class="s1">
</span><span class="s1">responses:
</span><span class="s1">  Standard500ErrorResponse:
</span><span class="s1">    description: An unexpected error occured.
</span><span class="s1">    schema:
</span><span class="s1">      $ref: &#34;#/definitions/Error&#34;
</span><span class="s1">  PersonDoesNotExistResponse:
</span><span class="s1">    description: Person does not exist.
</span><span class="s1">
</span><span class="s1">parameters:
</span><span class="s1">  username:
</span><span class="s1">    name: username
</span><span class="s1">    in: path
</span><span class="s1">    required: true
</span><span class="s1">    description: The person&#39;</span>s<span class="w"> </span>username<span class="w">
</span><span class="w">    </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">  </span><span class="k">pageSize</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">name</span><span class="p">:</span><span class="w"> </span>pageSize<span class="w">
</span><span class="w">    </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>query<span class="w">
</span><span class="w">    </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Number<span class="w"> </span>of<span class="w"> </span>persons<span class="w"> </span>returned<span class="w">
</span><span class="w">    </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>integer<span class="w">
</span><span class="w">  </span><span class="k">pageNumber</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">name</span><span class="p">:</span><span class="w"> </span>pageNumber<span class="w">
</span><span class="w">    </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>query<span class="w">
</span><span class="w">    </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Page<span class="w"> </span>number<span class="w">
</span><span class="w">    </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>integer<span class="w">
</span><span class="w">
</span></code></pre></div><h4 id="路径参数只定义一次">路径参数只定义一次</h4>
<p>如果我们现在想要删除一个用户的信息，就需要增加一个 <em>delete /persons/{username}</em> 的操作，可以这样：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">  </span>/persons/{<span class="k">username}</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">get</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">summary</span><span class="p">:</span><span class="w"> </span>Gets<span class="w"> </span>a<span class="w"> </span>person<span class="w">
</span><span class="w">      </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Returns<span class="w"> </span>a<span class="w"> </span>single<span class="w"> </span>person<span class="w"> </span>for<span class="w"> </span>its<span class="w"> </span>username.<span class="w">
</span><span class="w">      </span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">        </span>- <span class="k">name</span><span class="p">:</span><span class="w"> </span>username<span class="w">
</span><span class="w">          </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>path<span class="w">
</span><span class="w">          </span><span class="k">required</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>The<span class="w"> </span>person<span class="s1">&#39;s username
</span><span class="s1">          type: string
</span><span class="s1">      responses:
</span><span class="s1">        200:
</span><span class="s1">          description: A Person
</span><span class="s1">          schema:
</span><span class="s1">            $ref: &#34;#/definitions/Person&#34;
</span><span class="s1">        404:
</span><span class="s1">          $ref: &#34;#/responses/PersonDoesNotExistResponse&#34;
</span><span class="s1">        500:
</span><span class="s1">          $ref: &#34;#/responses/Standard500ErrorResponse&#34;
</span><span class="s1">    delete:
</span><span class="s1">      summary: Deletes a person
</span><span class="s1">      description: Delete a single person identified via its username
</span><span class="s1">      parameters:
</span><span class="s1">        - name: username
</span><span class="s1">          in: path
</span><span class="s1">          required: true
</span><span class="s1">          description: The person&#39;</span>s<span class="w"> </span>username<span class="w">
</span><span class="w">          </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">      </span><span class="k">responses</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">204</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Person<span class="w"> </span>successfully<span class="w"> </span>deleted.<span class="w">
</span><span class="w">        </span><span class="k">404</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#/responses/PersonDoesNotExistResponse&#34;</span><span class="w">
</span><span class="w">        </span><span class="k">500</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#/responses/Standard500ErrorResponse&#34;</span><span class="w">
</span><span class="w">
</span></code></pre></div><p>但是上面两次对参数 <em>username</em> 的定义，却让人有点难受。好消息是我们可以定义<a href="https://github.com/OAI/OpenAPI-Specification/blob/master/versions/2.0.md#pathItemObject"><code>路径</code>级别的参数</a>（之前都是定义在操作级别。）</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">  </span>/persons/{<span class="k">username}</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="k">name</span><span class="p">:</span><span class="w"> </span>username<span class="w">
</span><span class="w">        </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>path<span class="w">
</span><span class="w">        </span><span class="k">required</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">        </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>The<span class="w"> </span>person&#39;s<span class="w"> </span>username<span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">    </span><span class="k">get</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">summary</span><span class="p">:</span><span class="w"> </span>Gets<span class="w"> </span>a<span class="w"> </span>person<span class="w">
</span><span class="w">      </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Returns<span class="w"> </span>a<span class="w"> </span>single<span class="w"> </span>person<span class="w"> </span>for<span class="w"> </span>its<span class="w"> </span>username.<span class="w">
</span><span class="w">      </span><span class="k">responses</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">200</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>A<span class="w"> </span>Person<span class="w">
</span><span class="w">          </span><span class="k">schema</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#/definitions/Person&#34;</span><span class="w">
</span><span class="w">        </span><span class="k">404</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#/responses/PersonDoesNotExistResponse&#34;</span><span class="w">
</span><span class="w">        </span><span class="k">500</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#/responses/Standard500ErrorResponse&#34;</span><span class="w">
</span><span class="w">    </span><span class="k">delete</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">summary</span><span class="p">:</span><span class="w"> </span>Deletes<span class="w"> </span>a<span class="w"> </span>person<span class="w">
</span><span class="w">      </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Delete<span class="w"> </span>a<span class="w"> </span>single<span class="w"> </span>person<span class="w"> </span>identified<span class="w"> </span>via<span class="w"> </span>its<span class="w"> </span>username<span class="w">
</span><span class="w">      </span><span class="k">responses</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">204</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Person<span class="w"> </span>successfully<span class="w"> </span>deleted.<span class="w">
</span><span class="w">        </span><span class="k">404</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#/responses/PersonDoesNotExistResponse&#34;</span><span class="w">
</span><span class="w">        </span><span class="k">500</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#/responses/Standard500ErrorResponse&#34;</span><span class="w">
</span><span class="w">
</span></code></pre></div><h4 id="定义可重用的参数">定义可重用的参数</h4>
<p>如果我们想根据用户名查找该用户的朋友圈，可以添加一个 <em>get /persons/{username}/friends</em> 的操作。根据前面所学的内容，第一反应应该这样写：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">  </span>/persons/{<span class="k">username}/friends</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="k">name</span><span class="p">:</span><span class="w"> </span>username<span class="w">
</span><span class="w">        </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>path<span class="w">
</span><span class="w">        </span><span class="k">required</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">        </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>The<span class="w"> </span>person<span class="s1">&#39;s username
</span><span class="s1">        type: string
</span><span class="s1">    get:
</span><span class="s1">      summary: Gets a person&#39;</span>s<span class="w"> </span>friends<span class="w">
</span><span class="w">      </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Returns<span class="w"> </span>a<span class="w"> </span>list<span class="w"> </span>containing<span class="w"> </span>all<span class="w"> </span>persons.<span class="w"> </span>The<span class="w"> </span>list<span class="w"> </span>supports<span class="w"> </span>paging.<span class="w">
</span><span class="w">      </span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">       </span>- <span class="k">name</span><span class="p">:</span><span class="w"> </span>pageSize<span class="w">
</span><span class="w">         </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>query<span class="w">
</span><span class="w">         </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Number<span class="w"> </span>of<span class="w"> </span>persons<span class="w"> </span>returned<span class="w">
</span><span class="w">         </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>integer<span class="w">
</span><span class="w">       </span>- <span class="k">name</span><span class="p">:</span><span class="w"> </span>pageNumber<span class="w">
</span><span class="w">         </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>query<span class="w">
</span><span class="w">         </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Page<span class="w"> </span>number<span class="w">
</span><span class="w">         </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>integer<span class="w">
</span><span class="w">      </span><span class="k">responses</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">200</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>A<span class="w"> </span>person&#39;s<span class="w"> </span>friends<span class="w"> </span>list<span class="w"> 
</span><span class="w">          </span><span class="k">schema</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#/definitions/Persons&#34;</span><span class="w">
</span><span class="w">        </span><span class="k">404</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#/responses/PersonDoesNotExistResponse&#34;</span><span class="w">
</span><span class="w">        </span><span class="k">500</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#/responses/Standard500ErrorResponse&#34;</span><span class="w">
</span><span class="w">
</span></code></pre></div><p>可以看到，关于 <em>username</em> 、<em>pageSize</em> 、<em>pageNumber</em> 的定义跟前面的 <em>/person/{username}</em> 、 <em>get /persons</em> 中的定义重复。如何消除重复呢？</p>
<h5 id="定义可重用的参数-1">定义可重用的参数</h5>
<p>根据3.1和3.2中的内容，我们可以参考<a href="https://github.com/OAI/OpenAPI-Specification/blob/master/versions/2.0.md#swaggerObject">OpenAPI规范</a>，融汇贯通。</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">username</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">name</span><span class="p">:</span><span class="w"> </span>username<span class="w">
</span><span class="w">    </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>path<span class="w">
</span><span class="w">    </span><span class="k">required</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">    </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>The<span class="w"> </span>person&#39;s<span class="w"> </span>username<span class="w">
</span><span class="w">    </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">  </span><span class="k">pageSize</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">name</span><span class="p">:</span><span class="w"> </span>pageSize<span class="w">
</span><span class="w">    </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>query<span class="w">
</span><span class="w">    </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Number<span class="w"> </span>of<span class="w"> </span>persons<span class="w"> </span>returned<span class="w">
</span><span class="w">    </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>integer<span class="w">
</span><span class="w">  </span><span class="k">pageNumber</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">name</span><span class="p">:</span><span class="w"> </span>pageNumber<span class="w">
</span><span class="w">    </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>query<span class="w">
</span><span class="w">    </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Page<span class="w"> </span>number<span class="w">
</span><span class="w">    </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>integer<span class="w">
</span><span class="w">
</span></code></pre></div><h5 id="使用定义参数">使用定义参数</h5>
<p>借助万能的<code>引用</code>（<em>$ref</em>），这都是小菜一碟。比如：</p>
<h6 id="get-persons">get /persons</h6>
<p>原来：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">  </span><span class="k">/persons</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">get</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">summary</span><span class="p">:</span><span class="w"> </span>Gets<span class="w"> </span>some<span class="w"> </span>persons<span class="w">
</span><span class="w">      </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Returns<span class="w"> </span>a<span class="w"> </span>list<span class="w"> </span>containing<span class="w"> </span>all<span class="w"> </span>persons.<span class="w"> </span>The<span class="w"> </span>list<span class="w"> </span>supports<span class="w"> </span>paging.<span class="w">
</span><span class="w">      </span>parameters<span class="w">
</span><span class="w">       </span>- <span class="k">name</span><span class="p">:</span><span class="w"> </span>pageSize<span class="w">
</span><span class="w">         </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>query<span class="w">
</span><span class="w">         </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Number<span class="w"> </span>of<span class="w"> </span>persons<span class="w"> </span>returned<span class="w">
</span><span class="w">         </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>integer<span class="w">
</span><span class="w">       </span>- <span class="k">name</span><span class="p">:</span><span class="w"> </span>pageNumber<span class="w">
</span><span class="w">         </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>query<span class="w">
</span><span class="w">         </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Page<span class="w"> </span>number<span class="w">
</span><span class="w">         </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>integer<span class="w">
</span><span class="w">
</span></code></pre></div><p>现在：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">  </span><span class="k">/persons</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">get</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">summary</span><span class="p">:</span><span class="w"> </span>Gets<span class="w"> </span>some<span class="w"> </span>persons<span class="w">
</span><span class="w">      </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Returns<span class="w"> </span>a<span class="w"> </span>list<span class="w"> </span>containing<span class="w"> </span>all<span class="w"> </span>persons.<span class="w"> </span>The<span class="w"> </span>list<span class="w"> </span>supports<span class="w"> </span>paging.<span class="w">
</span><span class="w">      </span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">       </span>- <span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#/parameters/pageSize&#34;</span><span class="w">
</span><span class="w">       </span>- <span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#/parameters/pageNumber&#34;</span><span class="w">
</span><span class="w">
</span></code></pre></div><h6 id="get-和-delete-personsusername">get 和 delete /persons/{username}</h6>
<p>原来：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">  </span>/persons/{<span class="k">username}</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="k">name</span><span class="p">:</span><span class="w"> </span>username<span class="w">
</span><span class="w">        </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>path<span class="w">
</span><span class="w">        </span><span class="k">required</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">        </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>The<span class="w"> </span>person&#39;s<span class="w"> </span>username<span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">
</span></code></pre></div><p>现在：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">  </span>/persons/{<span class="k">username}</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#/parameters/username&#34;</span><span class="w">
</span><span class="w">
</span></code></pre></div><h6 id="get-personsusernamefriends">get /persons/{username}/friends</h6>
<p>原来：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">  </span>/persons/{<span class="k">username}/friends</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="k">name</span><span class="p">:</span><span class="w"> </span>username<span class="w">
</span><span class="w">        </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>path<span class="w">
</span><span class="w">        </span><span class="k">required</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">        </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>The<span class="w"> </span>person<span class="s1">&#39;s username
</span><span class="s1">        type: string
</span><span class="s1">    get:
</span><span class="s1">      summary: Gets a person&#39;</span>s<span class="w"> </span>friends<span class="w">
</span><span class="w">      </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Returns<span class="w"> </span>a<span class="w"> </span>list<span class="w"> </span>containing<span class="w"> </span>all<span class="w"> </span>persons.<span class="w"> </span>The<span class="w"> </span>list<span class="w"> </span>supports<span class="w"> </span>paging.<span class="w">
</span><span class="w">      </span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">       </span>- <span class="k">name</span><span class="p">:</span><span class="w"> </span>pageSize<span class="w">
</span><span class="w">         </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>query<span class="w">
</span><span class="w">         </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Number<span class="w"> </span>of<span class="w"> </span>persons<span class="w"> </span>returned<span class="w">
</span><span class="w">         </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>integer<span class="w">
</span><span class="w">       </span>- <span class="k">name</span><span class="p">:</span><span class="w"> </span>pageNumber<span class="w">
</span><span class="w">         </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>query<span class="w">
</span><span class="w">         </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Page<span class="w"> </span>number<span class="w">
</span><span class="w">         </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>integer<span class="w">
</span><span class="w">
</span></code></pre></div><p>现在：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">  </span>/persons/{<span class="k">username}/friends</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#/parameters/username&#34;</span><span class="w">
</span><span class="w">    </span><span class="k">get</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">summary</span><span class="p">:</span><span class="w"> </span>Gets<span class="w"> </span>a<span class="w"> </span>person&#39;s<span class="w"> </span>friends<span class="w">
</span><span class="w">      </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Returns<span class="w"> </span>a<span class="w"> </span>list<span class="w"> </span>containing<span class="w"> </span>all<span class="w"> </span>persons.<span class="w"> </span>The<span class="w"> </span>list<span class="w"> </span>supports<span class="w"> </span>paging.<span class="w">
</span><span class="w">      </span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">       </span>- <span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#/parameters/pageSize&#34;</span><span class="w">
</span><span class="w">       </span>- <span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#/parameters/pageNumber&#34;</span><span class="w">
</span><span class="w">
</span></code></pre></div><hr>
<h2 id="第4章-深入了解一下">第4章 深入了解一下</h2>
<p>通过前面的练习，我们可以写出一篇结构清晰、内容精炼的API文档了。可是OpenAPI规范还给我们提供了更多的便利和惊喜，等着我们去了解和掌握。这一章主要介绍用于定义属性和数据模型的高级方法。</p>
<h3 id="私人定制">私人定制</h3>
<blockquote>
<p>Primitive data types in the Swagger Specification are based on the types supported by the JSON-Schema Draft 4. Models are described using the Schema Object which is a subset of JSON Schema Draft 4. <a href="https://github.com/OAI/OpenAPI-Specification/blob/master/versions/2.0.md#data-types">OpenAPI Specification Data Types</a></p>
</blockquote>
<p>使用 <a href="http://json-schema.org/documentation.html">JSON Schema Draft 4</a>，我们可以定义任意类型的各种属性，举例说明。</p>
<h4 id="字符串strings长度和格式">字符串（Strings）长度和格式</h4>
<p>当定义个字符串属性时，我们可以定制它的长度及格式：</p>
<table>
<thead>
<tr>
<th>属性</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>minLength</td>
<td>number</td>
<td>字符串最小长度</td>
</tr>
<tr>
<td>maxLength</td>
<td>number</td>
<td>字符串最大长度</td>
</tr>
<tr>
<td>pattern</td>
<td>string</td>
<td>正则表达式 (如果你暂时还不熟悉正则表达式，可以看看 <a href="https://regex101.com/">Regex 101</a>)</td>
</tr>
</tbody>
</table>
<p>如果我们规定用户名是长度介于8~64，而且只能由小写字母和数字来构成，那么我们可以这样写：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">      </span><span class="k">username</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">        </span><span class="k">pattern</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;[a-z0-9]{8,64}&#34;</span><span class="w">
</span><span class="w">        </span><span class="k">minLength</span><span class="p">:</span><span class="w"> </span><span class="m">8</span><span class="w">
</span><span class="w">        </span><span class="k">maxLength</span><span class="p">:</span><span class="w"> </span><span class="m">64</span><span class="w">
</span><span class="w">
</span></code></pre></div><h4 id="日期和时间">日期和时间</h4>
<p>日期和时间的处理参考 <a href="http://xml2rfc.ietf.org/public/rfc/html/rfc3339">RFC 3339</a> ，我们唯一要做的就是写对格式：</p>
<table>
<thead>
<tr>
<th>格式</th>
<th>属性包含内容</th>
<th>属性示例</th>
</tr>
</thead>
<tbody>
<tr>
<td>date</td>
<td><a href="http://xml2rfc.ietf.org/public/rfc/html/rfc3339.html#anchor14">ISO8601 full-date</a></td>
<td>2016-04-01</td>
</tr>
<tr>
<td>dateTime</td>
<td><a href="http://xml2rfc.ietf.org/public/rfc/html/rfc3339.html#anchor14">ISO8601 date-time</a></td>
<td>2016-04-16T16:06:05Z</td>
</tr>
</tbody>
</table>
<p>如果我们在 <em>Person</em> 的定义中增加 <code>生日</code> 和 <code>上次登录时间</code> 时间戳，我们可以这样写：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">      </span><span class="k">dateOfBirth</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">        </span><span class="k">format</span><span class="p">:</span><span class="w"> </span>date<span class="w">
</span><span class="w">      </span><span class="k">lastTimeOnline</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">        </span><span class="k">format</span><span class="p">:</span><span class="w"> </span>dateTime<span class="w">
</span><span class="w">
</span></code></pre></div><p>如果想深入掌握API中处理日期和时间的方法，我们应该继续阅读 <a href="https://twitter.com/jharmn">Jason Harmon</a> 写的文章《 <a href="http://apiux.com/2013/03/20/5-laws-api-dates-and-times/">5 laws of API dates and times</a> 》。</p>
<h4 id="数字类型和范围">数字类型和范围</h4>
<p>当我们定义一个数字类型的属性时，我们可以<a href="https://github.com/OAI/OpenAPI-Specification/blob/master/versions/2.0.md#data-types">规定</a>它是一个整型、长型、浮点型或者双浮点型。</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>类型</th>
<th>格式</th>
</tr>
</thead>
<tbody>
<tr>
<td>integer</td>
<td>integer</td>
<td>int32</td>
</tr>
<tr>
<td>long</td>
<td>integer</td>
<td>int64</td>
</tr>
<tr>
<td>float</td>
<td>number</td>
<td>float</td>
</tr>
<tr>
<td>double</td>
<td>number</td>
<td>double</td>
</tr>
</tbody>
</table>
<p>和字符串一样，我们也可以定义数字属性的范围，比如：</p>
<table>
<thead>
<tr>
<th>属性</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>minimum</td>
<td>number</td>
<td>最小值</td>
</tr>
<tr>
<td>maximum</td>
<td>number</td>
<td>最大值</td>
</tr>
<tr>
<td>exclusiveMinimum</td>
<td>boolean</td>
<td>数值必须 &gt; 最小值</td>
</tr>
<tr>
<td>exclusiveMaximum</td>
<td>boolean</td>
<td>数值必须 &lt; 最大值</td>
</tr>
<tr>
<td>multipleOf</td>
<td>number</td>
<td>数值必须是multipleOf的整数倍</td>
</tr>
</tbody>
</table>
<p>如果我们规定 <em>pageSize</em> 必须是整数，必须 &gt; 0 且 &lt;=100，还必须是 10 的整数倍，可以这样写：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">  </span><span class="k">pageSize</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">name</span><span class="p">:</span><span class="w"> </span>pageSize<span class="w">
</span><span class="w">    </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>query<span class="w">
</span><span class="w">    </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Number<span class="w"> </span>of<span class="w"> </span>persons<span class="w"> </span>returned<span class="w">
</span><span class="w">    </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>integer<span class="w">
</span><span class="w">    </span><span class="k">format</span><span class="p">:</span><span class="w"> </span>int32<span class="w">
</span><span class="w">    </span><span class="k">minimum</span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="w">
</span><span class="w">    </span><span class="k">exclusiveMinimum</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">    </span><span class="k">maximum</span><span class="p">:</span><span class="w"> </span><span class="m">100</span><span class="w">
</span><span class="w">    </span><span class="k">exclusiveMaximum</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span><span class="w">    </span><span class="k">multipleOf</span><span class="p">:</span><span class="w"> </span><span class="m">10</span><span class="w">
</span><span class="w">
</span></code></pre></div><h4 id="枚举类型">枚举类型</h4>
<p>我们还可以定义枚举类型，比如定义 <em>Error</em> 时，我们可以这样写：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">      </span><span class="k">code</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">        </span><span class="k">enum</span><span class="p">:</span><span class="w">
</span><span class="w">          </span>- DBERR<span class="w">
</span><span class="w">          </span>- NTERR<span class="w">
</span><span class="w">          </span>- UNERR<span class="w">
</span><span class="w">
</span></code></pre></div><p><em>code</em> 的值只能从三个枚举值中选择。</p>
<h4 id="数值的大小和唯一性">数值的大小和唯一性</h4>
<p>数字的大小和唯一性通过下面这些属性来定义：</p>
<table>
<thead>
<tr>
<th>属性</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>minItems</td>
<td>number</td>
<td>数值中的最小元素个数</td>
</tr>
<tr>
<td>maxItem</td>
<td>number</td>
<td>数值中的最大元素个数</td>
</tr>
<tr>
<td>uniqueItems</td>
<td>boolean</td>
<td>标示数组中的元素是否唯一</td>
</tr>
</tbody>
</table>
<p>比如我们定义一个用户数组 <em>Persons</em>，希望返回的用户信息条数介于10~100之间，而且不能有重复的用户信息，我们可以这样写：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">  </span><span class="k">Persons</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">properties</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">items</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>array<span class="w">
</span><span class="w">        </span><span class="k">minItems</span><span class="p">:</span><span class="w"> </span><span class="m">10</span><span class="w">
</span><span class="w">        </span><span class="k">maxItems</span><span class="p">:</span><span class="w"> </span><span class="m">100</span><span class="w">
</span><span class="w">        </span><span class="k">uniqueItems</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">        </span><span class="k">items</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#/definitions/Person&#34;</span><span class="w">
</span><span class="w">
</span></code></pre></div><h4 id="二进制数据">二进制数据</h4>
<p>可以用 <em>string</em> 类型来表示二进制数据：</p>
<table>
<thead>
<tr>
<th>格式</th>
<th>属性包含</th>
</tr>
</thead>
<tbody>
<tr>
<td>byte</td>
<td>Base64编码字符</td>
</tr>
<tr>
<td>binary</td>
<td>任意十进制的数据序列</td>
</tr>
</tbody>
</table>
<p>比如我们需要在用户信息中增加一个头像属性（<em>avatarBase64PNG</em>）用base64编码的PNG图片来表示，可以这样写：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">      </span><span class="k">avatarBase64PNG</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">        </span><span class="k">format</span><span class="p">:</span><span class="w"> </span>byte<span class="w">
</span><span class="w">
</span></code></pre></div><h3 id="高级数据定义">高级数据定义</h3>
<h4 id="读写操作同一定义的数据">读写操作同一定义的数据</h4>
<p>有时候我们读取资源信息的内容会比我们写入资源信息的内容（属性）更多，这很常见。是不是意味着我们必须专门为读取资源和写入资源分别定义不同的数据模型呢？幸运的是，OpenAPI规范中提供了 <em>readOnly</em> 字段来帮我们解决整问题。比如：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">      </span><span class="k">lastTimeOnline</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">        </span><span class="k">format</span><span class="p">:</span><span class="w"> </span>dateTime<span class="w">
</span><span class="w">        </span><span class="k">readOnly</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">
</span></code></pre></div><p>上面这个例子中，<code>上次在线时间</code>（<em>lastTimeOnline</em> ）是 <em>Person</em> 的一个属性，我们获取用户信息时需要这个属性。但是很明显，在创建用户时，我们不能把这个属性 <em>post</em> 到服务器。于是我们可以把它标记为 <em>readOnly</em>。</p>
<h4 id="组合定义确保一致性">组合定义确保一致性</h4>
<p>一致性设计是在编写API文档时需要重点考虑的问题。比如我们在获取一组用户信息时，需要同时获取<code>页面信息</code>（</p>
<p>totalItems, totalPage, pageSize, currentPage）等，而且这些信息<strong>必须</strong>在根节点上。</p>
<p>怎么办呢？首先想到的做法就是：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">  </span><span class="k">PagedPersonsV1</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">properties</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">items</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>array<span class="w">
</span><span class="w">        </span><span class="k">items</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#/definitions/Person&#34;</span><span class="w">
</span><span class="w">      </span><span class="k">totalItems</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>integer<span class="w">
</span><span class="w">      </span><span class="k">totalPages</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>integer<span class="w">
</span><span class="w">      </span><span class="k">pageSize</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>integer<span class="w">
</span><span class="w">      </span><span class="k">currentPage</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>integer<span class="w">
</span><span class="w">
</span></code></pre></div><p>如果其他API操作也需要这些<code>页面信息</code>，那就意味着这些属性必须一遍又一遍的定义。不仅重复体力劳动，而且还很危险：比如忘记了其中的一两个属性，或者需要添加一个新的属性进来，那就是霰弹式的修改，想想都很悲壮。</p>
<p>稍微好一点的做法，就是根据前面学习的内容，把这几个属性抽取出来，建立一个 <em>Paging</em> 模型，“一处定义、处处使用”：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">  </span><span class="k">PagedPersonsV2</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">properties</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">items</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>array<span class="w">
</span><span class="w">        </span><span class="k">items</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#/definitions/Person&#34;</span><span class="w">
</span><span class="w">      </span><span class="k">paging</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#/definitions/Paging&#34;</span><span class="w">
</span><span class="w">
</span><span class="w">  </span><span class="k">Paging</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">properties</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">totalItems</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>integer<span class="w">
</span><span class="w">      </span><span class="k">totalPages</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>integer<span class="w">
</span><span class="w">      </span><span class="k">pageSize</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>integer<span class="w">
</span><span class="w">      </span><span class="k">currentPage</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>integer<span class="w">
</span><span class="w">
</span></code></pre></div><p><strong>但是</strong>，页面属性都不再位于 <strong>根节点</strong>！与我们前面设定的要求不一样了。怎么破？</p>
<p><a href="https://github.com/OAI/OpenAPI-Specification/blob/master/versions/2.0.md#composition-and-inheritance-polymorphism">JSON Schema v4 property</a>中定义的<code>allOf</code>，能帮我们解围：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">  </span><span class="k">PagedPersons</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">allOf</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#/definitions/Persons&#34;</span><span class="w">
</span><span class="w">      </span>- <span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#/definitions/Paging&#34;</span><span class="w">
</span><span class="w">
</span></code></pre></div><p>上面这个例子表示，<em>PagedPersons</em> 根节点下，具有将 <em>Persons</em> 和 <em>Paging</em> <strong>展开</strong> 后的全部属性。</p>
<p><code>allOf</code>同样可以使用行内的数据定义，比如：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">  </span><span class="k">PagedCollectingItems</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">allOf</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="k">properties</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">items</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>array<span class="w">
</span><span class="w">            </span><span class="k">minItems</span><span class="p">:</span><span class="w"> </span><span class="m">10</span><span class="w">
</span><span class="w">            </span><span class="k">maxItems</span><span class="p">:</span><span class="w"> </span><span class="m">100</span><span class="w">
</span><span class="w">            </span><span class="k">uniqueItems</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">            </span><span class="k">items</span><span class="p">:</span><span class="w">
</span><span class="w">              </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#/definitions/CollectingItem&#34;</span><span class="w">
</span><span class="w">      </span>- <span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#/definitions/Paging&#34;</span><span class="w">
</span><span class="w">
</span></code></pre></div><h4 id="数据模型的继承todo">数据模型的继承（TODO）</h4>
<p>目前各工具支持程度不高，待续</p>
<hr>
<h2 id="第5章-输入输出模型">第5章 输入输出模型</h2>
<p>这一章主要介绍如何定义高度精确化的参数和响应消息等。</p>
<h3 id="高级参数定义">高级参数定义</h3>
<h4 id="必带参数和可选参数">必带参数和可选参数</h4>
<p>我们已经知道使用关键字<code>required</code>来定义一个必带参数。</p>
<h5 id="定义必带参数和可选参数">定义必带参数和可选参数</h5>
<p>在一个参数中，<code>required</code>是一个 <code>boolean</code> 型的可选值。它的默认值是 <em>false</em> 。</p>
<p>比如在某个操作中，<em>username</em> 是必填参数：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">  </span><span class="k">username</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">name</span><span class="p">:</span><span class="w"> </span>username<span class="w">
</span><span class="w">    </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>path<span class="w">
</span><span class="w">    </span><span class="k">required</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">    </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>The<span class="w"> </span>person&#39;s<span class="w"> </span>username<span class="w">
</span><span class="w">    </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">
</span></code></pre></div><h5 id="定义必带属性和可选属性">定义必带属性和可选属性</h5>
<p>根据定义，<code>required</code>是一个字符串列表，列表中包含各必带参数名。如果某个参数在这张列表中找不到，那就说明它不是必带参数。如果没有定义<code>required</code>，就说明所有参数都是可选。如果<code>required</code>定义在一个HTTP请求上，这说明所有的请求参数都是必填。</p>
<p>在 <em>POST 、persons</em> 中有 <em>Person</em> 的定义，在这里 <em>username</em> 这个属性是必带的，我们可以指定它为<code>required</code>，其他非必带字段则不指定：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w"> </span><span class="k">Person</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">required</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- username<span class="w">
</span><span class="w">    </span><span class="k">properties</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">firstName</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">      </span><span class="k">lastName</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">      </span><span class="k">username</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">        </span><span class="k">pattern</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;[a-z0-9]{8,64}&#39;</span><span class="w">
</span><span class="w">        </span><span class="k">minLength</span><span class="p">:</span><span class="w"> </span><span class="m">8</span><span class="w">
</span><span class="w">        </span><span class="k">maxLength</span><span class="p">:</span><span class="w"> </span><span class="m">64</span><span class="w">
</span><span class="w">      </span><span class="k">dateOfBirth</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">        </span><span class="k">format</span><span class="p">:</span><span class="w"> </span>date<span class="w">
</span><span class="w">      </span><span class="k">lastTimeOnline</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">        </span><span class="k">format</span><span class="p">:</span><span class="w"> </span>date-time<span class="w">
</span><span class="w">        </span><span class="k">readOnly</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">      </span><span class="k">avatarBase64PNG</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">        </span><span class="k">format</span><span class="p">:</span><span class="w"> </span>byte<span class="w">
</span><span class="w">        </span><span class="k">default</span><span class="p">:</span><span class="w"> </span>data<span class="p">:</span>image/png;base64<span class="p">,</span>i……<span class="w">
</span><span class="w">      </span><span class="k">spokenLanguages</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;#/definitions/SpokenLanguages&#39;</span><span class="w">
</span><span class="w">
</span></code></pre></div><h4 id="带默认值的参数">带默认值的参数</h4>
<p>通过关键字<code>default</code>，我们可以定义一个参数的默认值。当这个参数不可得（请求未带或者服务器未返回）时，这个参数就取默认值。因此设定了某个参数的默认值后，它是否<code>required</code>就没意义了。</p>
<h5 id="定义参数的默认值">定义参数的默认值</h5>
<p>我们定义参数 <em>pageSize</em> 的默认值为 <em>20</em> ，那么如果请求时没有填写 <em>pageSize</em> ，服务器也会默认返回 <em>20</em> 个元素。</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">  </span><span class="k">pageSize</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">name</span><span class="p">:</span><span class="w"> </span>pageSize<span class="w">
</span><span class="w">    </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>query<span class="w">
</span><span class="w">    </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Number<span class="w"> </span>of<span class="w"> </span>persons<span class="w"> </span>returned<span class="w">
</span><span class="w">    </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>integer<span class="w">
</span><span class="w">    </span><span class="k">format</span><span class="p">:</span><span class="w"> </span>int32<span class="w">
</span><span class="w">    </span><span class="k">minimum</span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="w">
</span><span class="w">    </span><span class="k">exclusiveMinimum</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">    </span><span class="k">maximum</span><span class="p">:</span><span class="w"> </span><span class="m">100</span><span class="w">
</span><span class="w">    </span><span class="k">exclusiveMaximum</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span><span class="w">    </span><span class="k">multipleOf</span><span class="p">:</span><span class="w"> </span><span class="m">10</span><span class="w">
</span><span class="w">    </span><span class="k">default</span><span class="p">:</span><span class="w"> </span><span class="m">20</span><span class="w">
</span><span class="w">
</span></code></pre></div><h5 id="定义属性的默认值">定义属性的默认值</h5>
<p>我们在定义 <em>Person</em> 对象时，希望给每个用户一个默认头像，也就是要给 <em>avatarBase64PNG</em> 属性一个默认值。</p>
<p>默认头像：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">  </span><span class="k">Person</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">required</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- username<span class="w">
</span><span class="w">    </span><span class="k">properties</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">firstName</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">      </span><span class="k">lastName</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">      </span><span class="k">username</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">        </span><span class="k">pattern</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;[a-z0-9]{8,64}&#39;</span><span class="w">
</span><span class="w">        </span><span class="k">minLength</span><span class="p">:</span><span class="w"> </span><span class="m">8</span><span class="w">
</span><span class="w">        </span><span class="k">maxLength</span><span class="p">:</span><span class="w"> </span><span class="m">64</span><span class="w">
</span><span class="w">      </span><span class="k">dateOfBirth</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">        </span><span class="k">format</span><span class="p">:</span><span class="w"> </span>date<span class="w">
</span><span class="w">      </span><span class="k">lastTimeOnline</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">        </span><span class="k">format</span><span class="p">:</span><span class="w"> </span>date-time<span class="w">
</span><span class="w">        </span><span class="k">readOnly</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">      </span><span class="k">avatarBase64PNG</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">        </span><span class="k">format</span><span class="p">:</span><span class="w"> </span>byte<span class="w">
</span><span class="w">        </span><span class="k">default</span><span class="p">:</span><span class="w"> </span>data<span class="p">:</span>image/png;base64<span class="p">,</span>iVBORw0KGgoAAAANSUhEUgA……rkJggg==<span class="w">
</span><span class="w">      </span><span class="k">spokenLanguages</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;#/definitions/SpokenLanguages&#39;</span><span class="w">
</span><span class="w">
</span></code></pre></div><h4 id="带空值的参数">带空值的参数</h4>
<p>在 <em>GET /persons</em> 时，如果我们想添加一个参数来过滤“是否通过实名认证”的用户，应该怎么做呢？首先想到的是这样：<em>GET /persons?page=2&amp;includeVerifiedUsers=true</em> ，问题是 <em>includeVerifiedUsers</em> 语义已经如此清晰，而让 “=true”显得很多余。我们能不能直接用：<em>GET /persons?page=2&amp;includeVerifiedUsers</em> 呢？</p>
<p>要做到这种写法，我们需要一个关键字 <code>allowEmptyValue</code>。我们定义 <em>includeVerifiedUsers</em> 时允许它为空。那么如果我们请求 <em>GET /persons?page=2&amp;includeVerifiedUsers</em> 则表示需要过滤“实名认证”用户，如果我们直接请求 <em>GET /persons?page=2</em> 则表示不过滤：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">  </span><span class="k">includeNonVerifiedUsers</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">name</span><span class="p">:</span><span class="w"> </span>includeNonVerifiedUsers<span class="w">
</span><span class="w">    </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>query<span class="w">
</span><span class="w">    </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>boolean<span class="w">
</span><span class="w">    </span><span class="k">default</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span><span class="w">    </span><span class="k">allowEmptyValue</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">
</span></code></pre></div><h4 id="参数组">参数组</h4>
<p>设计API的时候，我们经常会遇到在 <em>GET</em> 请求中需要携带一组请求参数的情况。如何在API文档章呈现呢？很简单，我们只需要设定<code>参数类型（type）</code> 为<code>array</code>，并选择合适的 <code>组合格式（collectionFormat）</code>就行了。</p>
<table>
<thead>
<tr>
<th>COLLECTIONFORMAT</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>csv (default value)</td>
<td>Comma separated values（逗号分隔） <code>foo,bar</code></td>
</tr>
<tr>
<td>ssv</td>
<td>Space separated values（空格分隔） <code>foo bar</code></td>
</tr>
<tr>
<td>tsv</td>
<td>Tab separated values（Tab分隔） <code>foo   bar</code></td>
</tr>
<tr>
<td>pipes</td>
<td>Pipes separated values（竖线分隔）<code> foo丨bar</code></td>
</tr>
<tr>
<td>multi</td>
<td>单属性可以取多个值，比如 <code>foo=bar&amp;foo=baz</code>. 只适用于查询参数和表单参数。</td>
</tr>
</tbody>
</table>
<p>比如我们想根据多种参数（<em>username</em> ， <em>firstname</em> ， <em>lastname</em> ， <em>lastTimeOnline</em> ）等来对 <em>Person</em> 进行带排序的查询。我们需要一个这样的API请求： <em>GET /persons?sort=-lastTimeOnline|+firtname|+lastname</em> 。用于排序的参数是 <em>sort</em> ，<code>+</code>表示升序，<code>-</code>表示降序。</p>
<p>相应的API文档，可以这样写：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">  </span><span class="k">sortPersons</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">name</span><span class="p">:</span><span class="w"> </span>sort<span class="w">
</span><span class="w">    </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>query<span class="w">
</span><span class="w">    </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>array<span class="w">
</span><span class="w">    </span><span class="k">uniqueItems</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">    </span><span class="k">minItems</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span><span class="w">    </span><span class="k">maxItems</span><span class="p">:</span><span class="w"> </span><span class="m">3</span><span class="w">
</span><span class="w">    </span><span class="k">collectionFormat</span><span class="p">:</span><span class="w"> </span>pipes<span class="w">
</span><span class="w">    </span><span class="k">items</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">      </span><span class="k">pattern</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;[-+](username|lastTimeOnline|firstname|lastname)&#39;</span><span class="w">
</span><span class="w">
</span></code></pre></div><p>现在我们就能搞定 <em>GET /persons?sort=-lastTimeOnline|+firtname|+lastname</em> 这种请求了。当然，我们还可以指定排序的默认值，锦上添花。</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">  </span><span class="k">sortPersons</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">name</span><span class="p">:</span><span class="w"> </span>sort<span class="w">
</span><span class="w">    </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>query<span class="w">
</span><span class="w">    </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>array<span class="w">
</span><span class="w">    </span><span class="k">uniqueItems</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">    </span><span class="k">minItems</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span><span class="w">    </span><span class="k">maxItems</span><span class="p">:</span><span class="w"> </span><span class="m">3</span><span class="w">
</span><span class="w">    </span><span class="k">collectionFormat</span><span class="p">:</span><span class="w"> </span>pipes<span class="w">
</span><span class="w">    </span><span class="k">items</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">      </span><span class="k">pattern</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;[-+](username|lastTimeOnline|firstname|lastname)&#39;</span><span class="w">
</span><span class="w">    </span><span class="k">default</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- -lastTimeOnline<span class="w">
</span><span class="w">      </span>- +username<span class="w">
</span><span class="w">
</span></code></pre></div><h4 id="消息头header参数">消息头（Header）参数</h4>
<p>参数，按照位置来分，不仅仅包含路径参数、请求参数和消息体参数，还包括消息头参数和表单参数等。比如我们可以在HTTP请求的消息头上加一个 <em>User-Agent</em> （用于跟踪、调试或者其他），可以这样定义它：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">  </span><span class="k">userAgent</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">name</span><span class="p">:</span><span class="w"> </span>User-Agent<span class="w">
</span><span class="w">    </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">    </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>header<span class="w">
</span><span class="w">    </span><span class="k">required</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">
</span></code></pre></div><p>然后像使用其他参数一样使用它：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">paths</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">/persons</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;#/parameters/userAgent&#39;</span><span class="w">
</span><span class="w">
</span></code></pre></div><h4 id="表单参数">表单参数</h4>
<p>有些 <em>js-less-browser</em> 的老浏览器不支持 <em>POST</em> JSON数据，比如在创建用户时，只能够以这样个格式请求：</p>
<div class="highlight"><pre class="chroma"><code class="language-Sh" data-lang="Sh">POST /js-less-persons

<span class="nv">username</span><span class="o">=</span>apihandyman<span class="p">&amp;</span><span class="nv">firstname</span><span class="o">=</span>API<span class="p">&amp;</span><span class="nv">lastname</span><span class="o">=</span>Handyman

</code></pre></div><p>没有问题，Swagger可以搞定。我们只需要把各个属性的<code>in</code>关键字定义为<code>formData</code>，然后设置<code>consumes</code>的媒体类型为<code>application/x-www-form-urlencoded</code>即可。</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">    </span><span class="k">post</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">summary</span><span class="p">:</span><span class="w"> </span>Creates<span class="w"> </span>a<span class="w"> </span>person<span class="w">
</span><span class="w">      </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>For<span class="w"> </span>JS-less<span class="w"> </span>partners<span class="w">
</span><span class="w">      </span><span class="k">consumes</span><span class="p">:</span><span class="w">
</span><span class="w">        </span>- application/x-www-form-urlencoded<span class="w">
</span><span class="w">      </span><span class="k">produces</span><span class="p">:</span><span class="w">
</span><span class="w">        </span>- text/html<span class="w">
</span><span class="w">      </span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">        </span>- <span class="k">name</span><span class="p">:</span><span class="w"> </span>username<span class="w">
</span><span class="w">          </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>formData<span class="w">
</span><span class="w">          </span><span class="k">required</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">          </span><span class="k">pattern</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;[a-z0-9]{8,64}&#39;</span><span class="w">
</span><span class="w">          </span><span class="k">minLength</span><span class="p">:</span><span class="w"> </span><span class="m">8</span><span class="w">
</span><span class="w">          </span><span class="k">maxLength</span><span class="p">:</span><span class="w"> </span><span class="m">64</span><span class="w">
</span><span class="w">          </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">        </span>- <span class="k">name</span><span class="p">:</span><span class="w"> </span>firstname<span class="w">
</span><span class="w">          </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>formData<span class="w">
</span><span class="w">          </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">        </span>- <span class="k">name</span><span class="p">:</span><span class="w"> </span>lastname<span class="w">
</span><span class="w">          </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>formData<span class="w">
</span><span class="w">          </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">        </span>- <span class="k">name</span><span class="p">:</span><span class="w"> </span>dateOfBirth<span class="w">
</span><span class="w">          </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>formData<span class="w">
</span><span class="w">          </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">          </span><span class="k">format</span><span class="p">:</span><span class="w"> </span>date<span class="w">
</span><span class="w">      </span><span class="k">responses</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">&#39;204&#39;</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Person<span class="w"> </span>succesfully<span class="w"> </span>created.<span class="w">
</span><span class="w">
</span></code></pre></div><h4 id="文件参数">文件参数</h4>
<p>当我们要处理一个请求，输入类型是 <strong>文件</strong> 时，我们需要：</p>
<ul>
<li>使用 <em>multipart/form-data</em> 媒体类型；</li>
<li>设置参数的 <code>in</code>关键字为 <em>formData</em>；</li>
<li>设置参数的<code>类型（type）</code>为 <em>file</em>。</li>
</ul>
<p>比如：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">  </span><span class="k">/images</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;#/parameters/userAgent&#39;</span><span class="w">
</span><span class="w">    </span><span class="k">post</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">summary</span><span class="p">:</span><span class="w"> </span>Uploads<span class="w"> </span>an<span class="w"> </span>image<span class="w">
</span><span class="w">      </span><span class="k">consumes</span><span class="p">:</span><span class="w">
</span><span class="w">        </span>- multipart/form-data<span class="w">
</span><span class="w">      </span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">        </span>- <span class="k">name</span><span class="p">:</span><span class="w"> </span>image<span class="w">
</span><span class="w">          </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>formData<span class="w">
</span><span class="w">          </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>file<span class="w">
</span><span class="w">      </span><span class="k">responses</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">&#39;200&#39;</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Image&#39;s<span class="w"> </span>ID<span class="w">
</span><span class="w">          </span><span class="k">schema</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="k">properties</span><span class="p">:</span><span class="w">
</span><span class="w">              </span><span class="k">imageId</span><span class="p">:</span><span class="w">
</span><span class="w">                </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">
</span></code></pre></div><p>有时候我们想限定输入文件的类型（后缀），很不幸的是，根据现在V2.0的规范暂时还做不到☹</p>
<blockquote>
<p>The spec doesn’t allow specifying a content type for specific form data parameters. It’s a limitation of the spec. <em>Ron Ratovsky comment in Swagger UI 609 issue</em></p>
</blockquote>
<h4 id="参数的媒体类型">参数的媒体类型</h4>
<p>一个API可以消费各种不同的媒体类型，比如说最常见的是 <em>application/json</em> 类型的数据，当然这不是API唯一支持的类型。我们可以在<strong>文档的根节点</strong> 或者一个<strong>操作的根节点</strong> 下添加关键字 <code>consumes</code>，来定义这个操作能够消费的媒体类型。</p>
<p>比如我们的API全部都接受JSON和YAML的数据，那我们可以在文档的根节点下添加：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">consumes</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- application/json<span class="w">
</span><span class="w">  </span>- application/x-yaml<span class="w">
</span><span class="w">
</span></code></pre></div><p>如果某个操作（比如上传图片的操作）很特殊，它可以通过自己添加 <code>consumes</code>来覆盖全局设置：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">  </span><span class="k">/images</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;#/parameters/userAgent&#39;</span><span class="w">
</span><span class="w">    </span><span class="k">post</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">summary</span><span class="p">:</span><span class="w"> </span>Uploads<span class="w"> </span>an<span class="w"> </span>image<span class="w">
</span><span class="w">      </span><span class="k">consumes</span><span class="p">:</span><span class="w">
</span><span class="w">        </span>- multipart/form-data<span class="w">
</span><span class="w">      </span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">        </span>- <span class="k">name</span><span class="p">:</span><span class="w"> </span>image<span class="w">
</span><span class="w">          </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>formData<span class="w">
</span><span class="w">          </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>file<span class="w">
</span><span class="w">      </span><span class="k">responses</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">&#39;200&#39;</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Image&#39;s<span class="w"> </span>ID<span class="w">
</span><span class="w">          </span><span class="k">schema</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="k">properties</span><span class="p">:</span><span class="w">
</span><span class="w">              </span><span class="k">imageId</span><span class="p">:</span><span class="w">
</span><span class="w">                </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">
</span></code></pre></div><h3 id="高级响应消息定义">高级响应消息定义</h3>
<h4 id="不带消息体的响应消息">不带消息体的响应消息</h4>
<p>不带消息体的响应很常见，比如HTTP <em>204</em> 状态响应本身就表示服务器返回不带任何消息内容的成功消息。</p>
<p>要定义一个不带消息体的响应很简单，我们只需要写响应状态和描述就行了：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">    </span><span class="k">post</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">summary</span><span class="p">:</span><span class="w"> </span>Creates<span class="w"> </span>a<span class="w"> </span>person<span class="w">
</span><span class="w">      </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Adds<span class="w"> </span>a<span class="w"> </span>new<span class="w"> </span>person<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>persons<span class="w"> </span>list.<span class="w">
</span><span class="w">      </span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">        </span>- <span class="k">name</span><span class="p">:</span><span class="w"> </span>person<span class="w">
</span><span class="w">          </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>body<span class="w">
</span><span class="w">          </span><span class="k">required</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>The<span class="w"> </span>person<span class="w"> </span>to<span class="w"> </span>create.<span class="w">
</span><span class="w">          </span><span class="k">schema</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;#/definitions/Person&#39;</span><span class="w">
</span><span class="w">      </span><span class="k">responses</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">&#39;204&#39;</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Person<span class="w"> </span>succesfully<span class="w"> </span>created.<span class="w">
</span><span class="w">
</span></code></pre></div><h4 id="响应消息中的必带参数和可选参数">响应消息中的必带参数和可选参数</h4>
<p>与请求消息中类似，我们使用<code>required</code>参数来表示，比如请求一个用户信息时， 服务器必须返回<em>username</em>，可以这样写：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">  </span><span class="k">Person</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">required</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- username<span class="w">
</span><span class="w">    </span><span class="k">properties</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">firstName</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">      </span><span class="k">lastName</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">      </span><span class="k">username</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">        </span><span class="k">pattern</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;[a-z0-9]{8,64}&#39;</span><span class="w">
</span><span class="w">        </span><span class="k">minLength</span><span class="p">:</span><span class="w"> </span><span class="m">8</span><span class="w">
</span><span class="w">        </span><span class="k">maxLength</span><span class="p">:</span><span class="w"> </span><span class="m">64</span><span class="w">
</span><span class="w">      </span><span class="k">dateOfBirth</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">        </span><span class="k">format</span><span class="p">:</span><span class="w"> </span>date<span class="w">
</span><span class="w">      </span><span class="k">lastTimeOnline</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">        </span><span class="k">format</span><span class="p">:</span><span class="w"> </span>date-time<span class="w">
</span><span class="w">        </span><span class="k">readOnly</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">
</span></code></pre></div><h4 id="响应消息头">响应消息头</h4>
<p>API的返回结果不仅仅体现下HTTP状态和响应消息体，还可以在响应消息头上做文章。比如我们可以限定一个API的使用次数和使用时间段，在响应消息头中，增加一个属性<em>X-Rate-Limit-Remaining</em> 来表示API可调用的剩余次数，增加另一个属性 <em>X-Rate-Limit-Reset</em> 来表示API的有效截止时间。</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">    </span><span class="k">post</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">summary</span><span class="p">:</span><span class="w"> </span>Creates<span class="w"> </span>a<span class="w"> </span>person<span class="w">
</span><span class="w">      </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Adds<span class="w"> </span>a<span class="w"> </span>new<span class="w"> </span>person<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>persons<span class="w"> </span>list.<span class="w">
</span><span class="w">      </span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">        </span>- <span class="k">name</span><span class="p">:</span><span class="w"> </span>person<span class="w">
</span><span class="w">          </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>body<span class="w">
</span><span class="w">          </span><span class="k">required</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>The<span class="w"> </span>person<span class="w"> </span>to<span class="w"> </span>create.<span class="w">
</span><span class="w">          </span><span class="k">schema</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;#/definitions/Person&#39;</span><span class="w">
</span><span class="w">      </span><span class="k">responses</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">&#39;204&#39;</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Person<span class="w"> </span>succesfully<span class="w"> </span>created.<span class="w">
</span><span class="w">          </span><span class="k">headers</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="k">X-Rate-Limit-Remaining</span><span class="p">:</span><span class="w">
</span><span class="w">              </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>integer<span class="w">
</span><span class="w">            </span><span class="k">X-Rate-Limit-Reset</span><span class="p">:</span><span class="w">
</span><span class="w">              </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">              </span><span class="k">format</span><span class="p">:</span><span class="w"> </span>date-time<span class="w">
</span><span class="w">
</span></code></pre></div><p>美中不足的是，对于这种响应消息头的修改，目前2.0规范暂时还不支持“一次定义、处处使用”☹</p>
<h4 id="默认响应消息">默认响应消息</h4>
<p>我们在定义响应消息时，通常会列举不同的HTTP状态结果。如果有些状态不在我们API文档的定义范围（比如服务器需要返回 <em>993</em> 的状态），该怎么处理呢？这时需要通过关键字<code>default</code>来定义一个默认响应消息，用于各种<strong>定义之外</strong>的状态响应，比如：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">    </span><span class="k">delete</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">summary</span><span class="p">:</span><span class="w"> </span>Deletes<span class="w"> </span>a<span class="w"> </span>person<span class="w">
</span><span class="w">      </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Delete<span class="w"> </span>a<span class="w"> </span>single<span class="w"> </span>person<span class="w"> </span>identified<span class="w"> </span>via<span class="w"> </span>its<span class="w"> </span>username<span class="w">
</span><span class="w">      </span><span class="k">responses</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">&#39;204&#39;</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Person<span class="w"> </span>successfully<span class="w"> </span>deleted.<span class="w">
</span><span class="w">          </span><span class="k">headers</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="k">X-Rate-Limit-Remaining</span><span class="p">:</span><span class="w">
</span><span class="w">              </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>integer<span class="w">
</span><span class="w">            </span><span class="k">X-Rate-Limit-Reset</span><span class="p">:</span><span class="w">
</span><span class="w">              </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">              </span><span class="k">format</span><span class="p">:</span><span class="w"> </span>date-time<span class="w">
</span><span class="w">        </span><span class="k">&#39;404&#39;</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;#/responses/PersonDoesNotExistResponse&#39;</span><span class="w">
</span><span class="w">        </span><span class="k">&#39;500&#39;</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;#/responses/Standard500ErrorResponse&#39;</span><span class="w">
</span><span class="w">        </span><span class="k">default</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;#/responses/TotallyUnexpectedResponse&#39;</span><span class="w">
</span><span class="w">
</span></code></pre></div><p>目前这个配置也不支持“一次定义，处处使用” 。☹</p>
<h4 id="响应消息的媒体类型">响应消息的媒体类型</h4>
<p>与请求消息一样，我们也可以定义响应消息所支持的媒体类型，不同的是我们要用到关键字 <code>produces</code>（与请求消息中的<code>consumes</code>相对，由此可见，API文档描述的主体是<strong>服务提供者</strong>）。</p>
<p>比如，我们可以在文档的根路径下全局设置：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">produces</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- application/json<span class="w">
</span><span class="w">  </span>- application/x-yaml<span class="w">
</span><span class="w">
</span></code></pre></div><p>也可以在某个操作的根路径下覆盖设置：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">  </span>/images/{<span class="k">imageId}</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;#/parameters/userAgent&#39;</span><span class="w">
</span><span class="w">    </span><span class="k">get</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">summary</span><span class="p">:</span><span class="w"> </span>Gets<span class="w"> </span>an<span class="w"> </span>image<span class="w">
</span><span class="w">      </span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">        </span>- <span class="k">name</span><span class="p">:</span><span class="w"> </span>imageId<span class="w">
</span><span class="w">          </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>path<span class="w">
</span><span class="w">          </span><span class="k">required</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">          </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">      </span><span class="k">produces</span><span class="p">:</span><span class="w">
</span><span class="w">        </span>- image/png<span class="w">
</span><span class="w">        </span>- image/gif<span class="w">
</span><span class="w">        </span>- image/jpeg<span class="w">
</span><span class="w">        </span>- application/json<span class="w">
</span><span class="w">        </span>- application/x-yaml<span class="w"> 
</span><span class="w">      </span><span class="k">responses</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">&#39;200&#39;</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>The<span class="w"> </span>image<span class="w">
</span><span class="w">          </span><span class="k">headers</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="k">X-Rate-Limit-Remaining</span><span class="p">:</span><span class="w">
</span><span class="w">              </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>integer<span class="w">
</span><span class="w">            </span><span class="k">X-Rate-Limit-Reset</span><span class="p">:</span><span class="w">
</span><span class="w">              </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">              </span><span class="k">format</span><span class="p">:</span><span class="w"> </span>date-time<span class="w">
</span><span class="w">        </span><span class="k">&#39;404&#39;</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Image<span class="w"> </span>do<span class="w"> </span>not<span class="w"> </span>exists<span class="w">
</span><span class="w">          </span><span class="k">headers</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="k">X-Rate-Limit-Remaining</span><span class="p">:</span><span class="w">
</span><span class="w">              </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>integer<span class="w">
</span><span class="w">            </span><span class="k">X-Rate-Limit-Reset</span><span class="p">:</span><span class="w">
</span><span class="w">              </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">              </span><span class="k">format</span><span class="p">:</span><span class="w"> </span>date-time<span class="w">
</span><span class="w">        </span><span class="k">&#39;500&#39;</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;#/responses/Standard500ErrorResponse&#39;</span><span class="w">
</span><span class="w">        </span><span class="k">default</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;#/responses/TotallyUnexpectedResponse&#39;</span><span class="w">
</span><span class="w">
</span></code></pre></div><h3 id="定义某个参数只存在于响应消息中">定义某个参数只存在于响应消息中</h3>
<p>如前章节4.2.1中已经提到的，定义一个对象，其中某个属性我们只希望在响应消息中携带，而不希望在请求消息中携带，应该用<code>readOnly</code>关键字来表示。考虑到内容的完整性，这里再介绍一下。</p>
<p>比如 <em>Person</em> 对象中的 <em>lastTimeOnline</em> 这个属性，注册用户时我们不需要填写，但是在获取用户信息时，需要提供给服务消费者：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">  </span><span class="k">Person</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">required</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- username<span class="w">
</span><span class="w">    </span><span class="k">properties</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">firstName</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">      </span><span class="k">lastName</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">      </span><span class="k">username</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">        </span><span class="k">pattern</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;[a-z0-9]{8,64}&#39;</span><span class="w">
</span><span class="w">        </span><span class="k">minLength</span><span class="p">:</span><span class="w"> </span><span class="m">8</span><span class="w">
</span><span class="w">        </span><span class="k">maxLength</span><span class="p">:</span><span class="w"> </span><span class="m">64</span><span class="w">
</span><span class="w">      </span><span class="k">dateOfBirth</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">        </span><span class="k">format</span><span class="p">:</span><span class="w"> </span>date<span class="w">
</span><span class="w">      </span><span class="k">lastTimeOnline</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">        </span><span class="k">format</span><span class="p">:</span><span class="w"> </span>date-time<span class="w">
</span><span class="w">        </span><span class="k">readOnly</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">
</span></code></pre></div><hr>
<h2 id="第6章-不要让api裸奔">第6章 不要让API裸奔</h2>
<p>这一章主要介绍API文档中如何描述安全相关的内容。</p>
<h3 id="定义安全">定义安全</h3>
<p>安全相关内容的定义一般放在API文档根目录下的<code>securityDefinition</code> 中，它包括一组具体的命名安全项，每一个命名安全定义可能包括下面三种安全类型之一：<em>basic</em>，<em>apiKey</em> ，<em>oauth2</em>。</p>
<h4 id="基础鉴权basic-authentication">基础鉴权（Basic Authentication）</h4>
<p>要定义一个基础（<em>basic</em>） 鉴权，我们只需要将<code>type</code>设置为 <em>basic</em> 即可：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">securityDefinitions</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">UserSecurity</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>basic<span class="w">
</span><span class="w">  </span><span class="k">AdminSecurity</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>basic<span class="w">
</span><span class="w">  </span><span class="k">MediaSecurity</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>basic<span class="w">
</span><span class="w">
</span></code></pre></div><p>这个例子中，我们定义了三种安全说明（<em>UserSecurity</em>，<em>AdminSecurity</em>， <em>MediaSecurity</em>），都属于基础鉴权。</p>
<h4 id="api秘钥鉴权api-key">API秘钥鉴权（API Key）</h4>
<p>要定义一个API秘钥鉴权，我们需要：</p>
<ul>
<li>设置<code>type</code>为 <em>apiKey</em></li>
<li>通过关键字<code>in</code>指示api秘钥所在位置。通常api秘钥会放在消息头、请求参数或者消息体中</li>
<li>给安全项命个名字</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">securityDefinitions</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">UserSecurity</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>apiKey<span class="w">
</span><span class="w">    </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>header<span class="w">
</span><span class="w">    </span><span class="k">name</span><span class="p">:</span><span class="w"> </span>SIMPLE-API-KEY<span class="w">
</span><span class="w">  </span><span class="k">AdminSecurity</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>apiKey<span class="w">
</span><span class="w">    </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>header<span class="w">
</span><span class="w">    </span><span class="k">name</span><span class="p">:</span><span class="w"> </span>ADMIN-API-KEY<span class="w">
</span><span class="w">  </span><span class="k">MediaSecurity</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>apiKey<span class="w">
</span><span class="w">    </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>query<span class="w">
</span><span class="w">    </span><span class="k">name</span><span class="p">:</span><span class="w"> </span>MEDIA-API-KEY<span class="w">
</span><span class="w">
</span></code></pre></div><p>在这个例子中,我们定义了三个<code>apiKey</code>类型的安全项：</p>
<ul>
<li><em>UserSecurity</em> 定义了一个名为<em>SIMPLE-API-KEY</em> 的参数在消息头（header）</li>
<li><em>AdminSecurity</em> 定义了一个名为 <em>ADMIN-API-KEY</em> 的参数在消息头 （header）</li>
<li><em>MediaSecurity</em> 定义了一个名为<em>MEDIA-API-KEY</em>的参数在请求参数中</li>
</ul>
<h4 id="oauth2鉴权">Oauth2鉴权</h4>
<h5 id="流程flow和url">流程（Flow）和URL</h5>
<p>当我们定义个 <em>Oauth2</em> 类型的安全项上，我们通常会定义<em>Oauth2</em> 的流程（flow）和并根据选定的流程配置相应的<code>鉴权地址（authorizationUrl）</code>和/或<code>令牌地址（tokenUrl）</code>。</p>
<table>
<thead>
<tr>
<th>流程</th>
<th>所需要的URL</th>
</tr>
</thead>
<tbody>
<tr>
<td>implicit</td>
<td>authorizationUrl（鉴权地址）</td>
</tr>
<tr>
<td>password</td>
<td>tokenUrl（令牌地址）</td>
</tr>
<tr>
<td>application</td>
<td>tokenUrl</td>
</tr>
<tr>
<td>accessCode</td>
<td>authorizationUrl and tokenUrl</td>
</tr>
</tbody>
</table>
<p>比如：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">securityDefinitions</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">OauthSecurity</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>oauth2<span class="w">
</span><span class="w">    </span><span class="k">flow</span><span class="p">:</span><span class="w"> </span>accessCode<span class="w">
</span><span class="w">    </span><span class="k">authorizationUrl</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;https://oauth.simple.api/authorization&#39;</span><span class="w">
</span><span class="w">    </span><span class="k">tokenUrl</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;https://oauth.simple.api/token&#39;</span><span class="w">
</span><span class="w">
</span></code></pre></div><p>在这个例子中，我们定义了一个 <em>Oauth2</em> 的安全项，配置的流程是 <em>accessCode</em> 方式，同时配置了鉴权地址和令牌地址。</p>
<h5 id="作用范围scope">作用范围（scope）</h5>
<p>我们借助关键字<code>scopes</code>并通过哈希键值对来还可以配置 <em>Oauth2</em> 安全项的作用范围（scope），键值对的<strong>键</strong>表示作用范围名称；<strong>值</strong>是它的相关描述，比如：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">securityDefinitions</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">OauthSecurity</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>oauth2<span class="w">
</span><span class="w">    </span><span class="k">flow</span><span class="p">:</span><span class="w"> </span>accessCode<span class="w">
</span><span class="w">    </span><span class="k">authorizationUrl</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;https://oauth.simple.api/authorization&#39;</span><span class="w">
</span><span class="w">    </span><span class="k">tokenUrl</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;https://oauth.simple.api/token&#39;</span><span class="w">
</span><span class="w">    </span><span class="k">scopes</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">admin</span><span class="p">:</span><span class="w"> </span>Admin<span class="w"> </span>scope<span class="w">
</span><span class="w">      </span><span class="k">user</span><span class="p">:</span><span class="w"> </span>User<span class="w"> </span>scope<span class="w">
</span><span class="w">      </span><span class="k">media</span><span class="p">:</span><span class="w"> </span>Media<span class="w"> </span>scope<span class="w">
</span><span class="w">
</span></code></pre></div><p>在这个例子中，我们给 <em>OauthSecurity</em> 安全项添加了三个作用范围（<em>admin</em> ，<em>user</em> ，<em>media</em>）。</p>
<h3 id="使用安全定义">使用安全定义</h3>
<p>现在我们已经在<em>securityDefinition</em> 中定义好了安全项，现在我们可以将将它们应用到文档中了。使用的时候，我们通过<code>security</code>关键字，把安全项添加进去。</p>
<h4 id="基础鉴权">基础鉴权</h4>
<h5 id="api级别">API级别</h5>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">securityDefinitions</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">UserSecurity</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>basic<span class="w">
</span><span class="w">  </span><span class="k">AdminSecurity</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>basic<span class="w">
</span><span class="w">  </span><span class="k">MediaSecurity</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>basic<span class="w">
</span><span class="w"></span><span class="k">security</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- <span class="k">UserSecurity</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w"> 
</span><span class="w"></span><span class="k">paths</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">/persons</span><span class="p">:</span><span class="w">
</span><span class="w">
</span></code></pre></div><p>在这个例子中，我们在API文档的根路径下直接使用了安全项 <em>UserSecurity</em>，它的作用范围是整个API文档。</p>
<h5 id="操作级别">操作级别</h5>
<p>比如我们在添加或者修改用户信息时，需要进行管理员鉴权，可以在 <em>POST /persons</em> 操作中增加安全项：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">    </span><span class="k">post</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">summary</span><span class="p">:</span><span class="w"> </span>Creates<span class="w"> </span>a<span class="w"> </span>person<span class="w">
</span><span class="w">      </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Adds<span class="w"> </span>a<span class="w"> </span>new<span class="w"> </span>person<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>persons<span class="w"> </span>list.<span class="w">
</span><span class="w">      </span><span class="k">security</span><span class="p">:</span><span class="w">
</span><span class="w">        </span>- <span class="k">AdminSecurity</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w">
</span><span class="w">
</span></code></pre></div><p>而在上传图片时，需要进行媒体操作鉴权，可以在 <em>POST /images</em> 操作中增加安全项：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">  </span><span class="k">/images</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;#/parameters/userAgent&#39;</span><span class="w">
</span><span class="w">    </span><span class="k">post</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">summary</span><span class="p">:</span><span class="w"> </span>Uploads<span class="w"> </span>an<span class="w"> </span>image<span class="w">
</span><span class="w">      </span><span class="k">security</span><span class="p">:</span><span class="w">
</span><span class="w">        </span>- <span class="k">MediaSecurity</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w">
</span><span class="w">
</span></code></pre></div><h4 id="api秘钥鉴权">API秘钥鉴权</h4>
<p>使用方式和基础鉴权一样，可以在API级别和操作级别使用：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">securityDefinitions</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">UserSecurity</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>apiKey<span class="w">
</span><span class="w">    </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>header<span class="w">
</span><span class="w">    </span><span class="k">name</span><span class="p">:</span><span class="w"> </span>SIMPLE-API-KEY<span class="w">
</span><span class="w">  </span><span class="k">AdminSecurity</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>apiKey<span class="w">
</span><span class="w">    </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>header<span class="w">
</span><span class="w">    </span><span class="k">name</span><span class="p">:</span><span class="w"> </span>ADMIN-API-KEY<span class="w">
</span><span class="w">  </span><span class="k">MediaSecurity</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>apiKey<span class="w">
</span><span class="w">    </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>query<span class="w">
</span><span class="w">    </span><span class="k">name</span><span class="p">:</span><span class="w"> </span>media-api-key<span class="w">
</span><span class="w"></span><span class="k">security</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- <span class="k">UserSecurity</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w"> 
</span><span class="w"></span><span class="k">paths</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">/persons</span><span class="p">:</span><span class="w">
</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">    </span><span class="k">post</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">summary</span><span class="p">:</span><span class="w"> </span>Creates<span class="w"> </span>a<span class="w"> </span>person<span class="w">
</span><span class="w">      </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Adds<span class="w"> </span>a<span class="w"> </span>new<span class="w"> </span>person<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>persons<span class="w"> </span>list.<span class="w">
</span><span class="w">      </span><span class="k">security</span><span class="p">:</span><span class="w">
</span><span class="w">        </span>- <span class="k">AdminSecurity</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w">
</span><span class="w">
</span></code></pre></div><h4 id="oauth2鉴权-1">Oauth2鉴权</h4>
<p><em>Oauth2</em> 鉴权的使用和上面的两种鉴权方式基本相同，不同之处在于我们可以指定它的哪一个作用范围（scope）。</p>
<p>比如API级别的鉴权：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">securityDefinitions</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">OauthSecurity</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>oauth2<span class="w">
</span><span class="w">    </span><span class="k">flow</span><span class="p">:</span><span class="w"> </span>accessCode<span class="w">
</span><span class="w">    </span><span class="k">authorizationUrl</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;https://oauth.simple.api/authorization&#39;</span><span class="w">
</span><span class="w">    </span><span class="k">tokenUrl</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;https://oauth.simple.api/token&#39;</span><span class="w">
</span><span class="w">    </span><span class="k">scopes</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">admin</span><span class="p">:</span><span class="w"> </span>Admin<span class="w"> </span>scope<span class="w">
</span><span class="w">      </span><span class="k">user</span><span class="p">:</span><span class="w"> </span>User<span class="w"> </span>scope<span class="w">
</span><span class="w">      </span><span class="k">media</span><span class="p">:</span><span class="w"> </span>Media<span class="w"> </span>scope<span class="w">
</span><span class="w"></span><span class="k">security</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- <span class="k">OauthSecurity</span><span class="p">:</span><span class="w">
</span><span class="w">    </span>- user<span class="w">
</span><span class="w"></span><span class="k">paths</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">/persons</span><span class="p">:</span><span class="w">
</span><span class="w">
</span></code></pre></div><p>操作级别的鉴权：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">    </span><span class="k">post</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">summary</span><span class="p">:</span><span class="w"> </span>Creates<span class="w"> </span>a<span class="w"> </span>person<span class="w">
</span><span class="w">      </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Adds<span class="w"> </span>a<span class="w"> </span>new<span class="w"> </span>person<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>persons<span class="w"> </span>list.<span class="w">
</span><span class="w">      </span><span class="k">security</span><span class="p">:</span><span class="w">
</span><span class="w">        </span>- <span class="k">OauthSecurity</span><span class="p">:</span><span class="w">
</span><span class="w">          </span>- adminyaml<span class="w">
</span><span class="w">
</span></code></pre></div><p>在这个例子中，作用范围 <em>admin</em> 将覆盖全局配置的作用范围 <em>user</em> 。</p>
<h3 id="使用多种安全配置">使用多种安全配置</h3>
<p>OpenAPI规范并没有限定我们只能使用一种安全项。下面的例子将展示如何使用多种安全配置。</p>
<h4 id="安全定义">安全定义</h4>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">securityDefinitions</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">OauthSecurity</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>oauth2<span class="w">
</span><span class="w">    </span><span class="k">flow</span><span class="p">:</span><span class="w"> </span>accessCode<span class="w">
</span><span class="w">    </span><span class="k">authorizationUrl</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;https://oauth.simple.api/authorization&#39;</span><span class="w">
</span><span class="w">    </span><span class="k">tokenUrl</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;https://oauth.simple.api/token&#39;</span><span class="w">
</span><span class="w">    </span><span class="k">scopes</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">admin</span><span class="p">:</span><span class="w"> </span>Admin<span class="w"> </span>scope<span class="w">
</span><span class="w">      </span><span class="k">user</span><span class="p">:</span><span class="w"> </span>User<span class="w"> </span>scope<span class="w">
</span><span class="w">  </span><span class="k">MediaSecurity</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>apiKey<span class="w">
</span><span class="w">    </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>query<span class="w">
</span><span class="w">    </span><span class="k">name</span><span class="p">:</span><span class="w"> </span>media-api-key<span class="w">
</span><span class="w">  </span><span class="k">LegacySecurity</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>basic<span class="w">
</span><span class="w">
</span></code></pre></div><p>这个例子中，我们定义了三种鉴权方式。</p>
<h4 id="全局安全配置">全局安全配置</h4>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">security</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- <span class="k">OauthSecurity</span><span class="p">:</span><span class="w">
</span><span class="w">    </span>- user<span class="w">
</span><span class="w">  </span>- <span class="k">LegacySecurity</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w">
</span><span class="w">
</span></code></pre></div><p>这个配置的意思是用户可以通过两种方式中的<strong>任意一种</strong>来访问我们提供的API接口。</p>
<h4 id="覆盖全局配置">覆盖全局配置</h4>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">    </span><span class="k">post</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">summary</span><span class="p">:</span><span class="w"> </span>Creates<span class="w"> </span>a<span class="w"> </span>person<span class="w">
</span><span class="w">      </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Adds<span class="w"> </span>a<span class="w"> </span>new<span class="w"> </span>person<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>persons<span class="w"> </span>list.<span class="w">
</span><span class="w">      </span><span class="k">security</span><span class="p">:</span><span class="w">
</span><span class="w">        </span>- <span class="k">OauthSecurity</span><span class="p">:</span><span class="w">
</span><span class="w">          </span>- admin<span class="w">
</span><span class="w">        </span>- <span class="k">LegacySecurity</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w">
</span><span class="w">
</span></code></pre></div><p>在 <em>POST /persons</em> 操作中，<em>OauthSecurity</em> 的作用范围被覆写为<em>admin</em>。此时用户可以通过<em>admin</em> 的<em>Oauth2</em> <strong>或者</strong> <em>legacySecurity</em> 来鉴权使用这个操作。</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">  </span><span class="k">/images</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;#/parameters/userAgent&#39;</span><span class="w">
</span><span class="w">    </span><span class="k">post</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">summary</span><span class="p">:</span><span class="w"> </span>Uploads<span class="w"> </span>an<span class="w"> </span>image<span class="w">
</span><span class="w">      </span><span class="k">security</span><span class="p">:</span><span class="w">
</span><span class="w">        </span>- <span class="k">MediaSecurity</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w">
</span><span class="w">
</span></code></pre></div><p>在 <em>POST/images</em> 操作中，用<em>MediaSecurity</em> 整体覆写了全局安全项，用户只能通过 <em>MediaSecurity</em> 鉴权使用这个操作。</p>
<hr>
<h2 id="第7章-让文档的可读性更好">第7章 让文档的可读性更好</h2>
<h3 id="分类标签tags">分类标签（Tags）</h3>
<p>通过关键字<code>tags</code>我们可以对文档中接口进行归类，<code>tags</code>的本质是一个字符串列表。<code>tags</code>定义在文档的根路径下。</p>
<h4 id="单标签">单标签</h4>
<p>比如说 <em>GET /persons</em> 属于<strong>用户（Person）</strong> 这个分类的，那么我们可以给它贴个标签：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">paths</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">/persons</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;#/parameters/userAgent&#39;</span><span class="w">
</span><span class="w">    </span><span class="k">get</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">summary</span><span class="p">:</span><span class="w"> </span>Gets<span class="w"> </span>some<span class="w"> </span>persons<span class="w">
</span><span class="w">      </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Returns<span class="w"> </span>a<span class="w"> </span>list<span class="w"> </span>containing<span class="w"> </span>all<span class="w"> </span>persons.<span class="w"> </span>The<span class="w"> </span>list<span class="w"> </span>supports<span class="w"> </span>paging.<span class="w">
</span><span class="w">      </span><span class="k">operationId</span><span class="p">:</span><span class="w"> </span>searchUsers<span class="w">
</span><span class="w">      </span><span class="k">tags</span><span class="p">:</span><span class="w">
</span><span class="w">        </span>- Persons<span class="w">
</span><span class="w">
</span></code></pre></div><h4 id="多标签">多标签</h4>
<p>一个操作也可以同时贴几个标签，比如：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">  </span><span class="k">/js-less-consumer-persons</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;#/parameters/userAgent&#39;</span><span class="w">
</span><span class="w">    </span><span class="k">post</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">summary</span><span class="p">:</span><span class="w"> </span>Creates<span class="w"> </span>a<span class="w"> </span>person<span class="w">
</span><span class="w">      </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>For<span class="w"> </span>JS-less<span class="w"> </span>partners<span class="w">
</span><span class="w">      </span><span class="k">operationId</span><span class="p">:</span><span class="w"> </span>createUserJS<span class="w">
</span><span class="w">      </span><span class="k">deprecated</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">      </span><span class="k">tags</span><span class="p">:</span><span class="w">
</span><span class="w">        </span>- JSLess<span class="w">
</span><span class="w">        </span>- Persons<span class="w">
</span><span class="w">
</span></code></pre></div><p>贴上标签后，在Swagger Editor和Swagger UI中能够自动归类，我们可以按照标签来筛选接口，试试吧？</p>
<h3 id="无处不在的描述文字descriptions">无处不在的描述文字（Descriptions）</h3>
<p><code>description</code>这个属性几乎是无处不在，为了提高文档的可读性，我们应该在必要的地方都加上描述文字。</p>
<h4 id="安全项的描述">安全项的描述</h4>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">securityDefinitions</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">OauthSecurity</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>New<span class="w"> </span>Oauth<span class="w"> </span>security<span class="w"> </span>system.<span class="w"> </span>Do<span class="w"> </span>not<span class="w"> </span>use<span class="w"> </span>MediaSecurity<span class="w"> </span>or<span class="w"> </span>LegacySecurity.<span class="w">
</span><span class="w">    </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>oauth2<span class="w">
</span><span class="w">    </span><span class="k">flow</span><span class="p">:</span><span class="w"> </span>accessCode<span class="w">
</span><span class="w">    </span><span class="k">authorizationUrl</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;https://oauth.simple.api/authorization&#39;</span><span class="w">
</span><span class="w">    </span><span class="k">tokenUrl</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;https://oauth.simple.api/token&#39;</span><span class="w">
</span><span class="w">    </span><span class="k">scopes</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">admin</span><span class="p">:</span><span class="w"> </span>Admin<span class="w"> </span>scope<span class="w">
</span><span class="w">      </span><span class="k">user</span><span class="p">:</span><span class="w"> </span>User<span class="w"> </span>scope<span class="w">
</span><span class="w">  </span><span class="k">MediaSecurity</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Specific<span class="w"> </span>media<span class="w"> </span>security<span class="w"> </span>for<span class="w"> </span>backward<span class="w"> </span>compatibility.<span class="w"> </span>Use<span class="w"> </span>OauthSecurity<span class="w"> </span>instead.<span class="w">
</span><span class="w">    </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>apiKey<span class="w">
</span><span class="w">    </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>query<span class="w">
</span><span class="w">    </span><span class="k">name</span><span class="p">:</span><span class="w"> </span>media-api-key<span class="w">
</span><span class="w">  </span><span class="k">LegacySecurity</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Legacy<span class="w"> </span>security<span class="w"> </span>system<span class="w"> </span>for<span class="w"> </span>backward<span class="w"> </span>compatibility.<span class="w"> </span>Use<span class="w"> </span>OauthSecurity<span class="w"> </span>instead.<span class="w">
</span><span class="w">    </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>basic<span class="w">
</span><span class="w">
</span></code></pre></div><h4 id="模式schema的描述">模式（Schema）的描述</h4>
<p>每一种模式（Schema），都会有一个标题（title）和一段描述，比如：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">definitions</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">Person</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">title</span><span class="p">:</span><span class="w"> </span>Human<span class="w">
</span><span class="w">    </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>A<span class="w"> </span>person<span class="w"> </span>which<span class="w"> </span>can<span class="w"> </span>be<span class="w"> </span>the<span class="w"> </span>user<span class="w"> </span>itself<span class="w"> </span>or<span class="w"> </span>one<span class="w"> </span>of<span class="w"> </span>his<span class="w"> </span>friend<span class="w">
</span><span class="w">
</span></code></pre></div><h4 id="属性的描述">属性的描述</h4>
<p>比如：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">    </span><span class="k">properties</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">firstName</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>first<span class="w"> </span>name<span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">
</span></code></pre></div><h4 id="参数的描述">参数的描述</h4>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">paths</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">/persons</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">post</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">        </span>- <span class="k">name</span><span class="p">:</span><span class="w"> </span>person<span class="w">
</span><span class="w">          </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>body<span class="w">
</span><span class="w">          </span><span class="k">required</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>The<span class="w"> </span>person<span class="w"> </span>to<span class="w"> </span>create.<span class="w">
</span><span class="w">          </span><span class="k">schema</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;#/definitions/Person&#39;</span><span class="w">
</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">username</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">name</span><span class="p">:</span><span class="w"> </span>username<span class="w">
</span><span class="w">    </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>path<span class="w">
</span><span class="w">    </span><span class="k">required</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">    </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>The<span class="w"> </span>person&#39;s<span class="w"> </span>username<span class="w">
</span><span class="w">    </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">  </span><span class="k">pageSize</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">name</span><span class="p">:</span><span class="w"> </span>pageSize<span class="w">
</span><span class="w">    </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>query<span class="w">
</span><span class="w">    </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Number<span class="w"> </span>of<span class="w"> </span>persons<span class="w"> </span>returned<span class="w">
</span><span class="w">
</span></code></pre></div><h4 id="操作的概述summary描述和操作idoperationid">操作的概述（summary）、描述和操作ID（operationId）</h4>
<p>一个操作（Operation）通常都会包含概述和描述信息。而且我们还可以添加一个关键字<code>operationId</code>，这个关键字通常用来指示服务提供者对这个操作的<strong>处理函数</strong>的函数名。比如：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">paths</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">/persons</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;#/parameters/userAgent&#39;</span><span class="w">
</span><span class="w">    </span><span class="k">get</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">summary</span><span class="p">:</span><span class="w"> </span>Gets<span class="w"> </span>some<span class="w"> </span>persons<span class="w">
</span><span class="w">      </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Returns<span class="w"> </span>a<span class="w"> </span>list<span class="w"> </span>containing<span class="w"> </span>all<span class="w"> </span>persons.<span class="w"> </span>The<span class="w"> </span>list<span class="w"> </span>supports<span class="w"> </span>paging.<span class="w">
</span><span class="w">      </span><span class="k">operationId</span><span class="p">:</span><span class="w"> </span>searchUsers<span class="w">
</span><span class="w">
</span></code></pre></div><h4 id="响应消息的描述">响应消息的描述</h4>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">paths</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">/persons</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;#/parameters/userAgent&#39;</span><span class="w">
</span><span class="w">    </span><span class="k">get</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>……<span class="w">
</span><span class="w">      </span>……<span class="w">
</span><span class="w">      </span><span class="k">responses</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">&#39;200&#39;</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>A<span class="w"> </span>list<span class="w"> </span>of<span class="w"> </span>Person<span class="w">
</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">responses</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">Standard500ErrorResponse</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>An<span class="w"> </span>unexpected<span class="w"> </span>error<span class="w"> </span>occured.<span class="w">
</span><span class="w">
</span></code></pre></div><h4 id="响应消息头的描述">响应消息头的描述</h4>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">    </span><span class="k">headers</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">X-Rate-Limit-Remaining</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>How<span class="w"> </span>many<span class="w"> </span>calls<span class="w"> </span>consumer<span class="w"> </span>can<span class="w"> </span>do<span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>integer<span class="w">
</span><span class="w">      </span><span class="k">X-Rate-Limit-Reset</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>When<span class="w"> </span>rate<span class="w"> </span>limit<span class="w"> </span>will<span class="w"> </span>be<span class="w"> </span>reset<span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">        </span><span class="k">format</span><span class="p">:</span><span class="w"> </span>date-time<span class="w">
</span><span class="w">
</span></code></pre></div><h4 id="标签的描述">标签的描述</h4>
<p>我们在API文档的根路径下添加了<code>tags</code>的定义，对于其中的每一个标签，我们都可以添加描述信息：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">tags</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- <span class="k">name</span><span class="p">:</span><span class="w"> </span>Persons<span class="w">
</span><span class="w">    </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Everything<span class="w"> </span>you<span class="w"> </span>need<span class="w"> </span>to<span class="w"> </span>handle<span class="w"> </span>users<span class="w"> </span>and<span class="w"> </span>friends<span class="w">
</span><span class="w">
</span></code></pre></div><h3 id="在描述中使用markdown语法">在描述中使用Markdown语法</h3>
<p>在绝大部分的<code>description</code>中，我们可以使用GFM（Github Flavored Markdown）语法。</p>
<h4 id="多行描述">多行描述</h4>
<p>使用符号 <code>|</code> 然后在新行中打一个tab（注意：<strong>YAML的tab是两个空格</strong> ），就可以编辑多行描述，比如：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">  </span><span class="s1">&#39;/persons/{username}/collecting-items&#39;</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;#/parameters/username&#39;</span><span class="w">
</span><span class="w">      </span>- <span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;#/parameters/userAgent&#39;</span><span class="w">
</span><span class="w">    </span><span class="k">get</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">summary</span><span class="p">:</span><span class="w"> </span>Gets<span class="w"> </span>a<span class="w"> </span>person&#39;s<span class="w"> </span>collecting<span class="w"> </span>items<span class="w"> </span>list<span class="w">
</span><span class="w">      </span><span class="k">description</span><span class="p">:</span><span class="w"> </span><span class="sd">|
</span><span class="sd">        Returns a list containing all items this person is looking for.  </span><span class="w">
</span><span class="w">        </span>The<span class="w"> </span>list<span class="w"> </span>supports<span class="w"> </span>paging.<span class="w">
</span><span class="w">
</span></code></pre></div><h4 id="简单使用gfm">简单使用GFM</h4>
<p>比如我们要<strong>强调</strong>，可以这样写：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">externalDocs</span><span class="p">:</span><span class="w"> 
</span><span class="w">  </span><span class="k">description</span><span class="p">:</span><span class="w"> </span><span class="sd">|
</span><span class="sd">    **Complete** documentation describing how to use this API</span><span class="w">
</span><span class="w">  </span><span class="k">url</span><span class="p">:</span><span class="w"> </span>http<span class="p">:</span>//doc.simple.api/<span class="w">
</span><span class="w">
</span></code></pre></div><h4 id="带信息组的描述">带信息组的描述</h4>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">  </span><span class="k">CollectingItem</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">discriminator</span><span class="p">:</span><span class="w"> </span>itemType<span class="w">
</span><span class="w">    </span><span class="k">required</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- itemType<span class="w">
</span><span class="w">    </span><span class="k">properties</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">itemType</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">description</span><span class="p">:</span><span class="w"> </span><span class="sd">|
</span><span class="sd">          An item can be of different type:</span><span class="w">
</span><span class="w">
</span><span class="w">          </span>type<span class="w"> </span>|<span class="w"> </span>definition<span class="w">
</span><span class="w">          </span>-----|----------<span class="sd">-
</span><span class="sd">          Vinyl| #/definitions/Vinyl</span><span class="w">
</span><span class="w">          </span>VHS<span class="w">  </span>|<span class="w"> </span><span class="c">#/definitions/VHS</span><span class="w">
</span><span class="w">          </span>AudioCassette<span class="w"> </span>|<span class="w"> </span><span class="c">#/definitions/AudioCassette</span><span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">        </span><span class="k">enum</span><span class="p">:</span><span class="w">
</span><span class="w">          </span>- AudioCassette<span class="w">
</span><span class="w">          </span>- Vinyl<span class="w">
</span><span class="w">          </span>- VHS<span class="w">
</span><span class="w">
</span></code></pre></div><h4 id="带代码的描述">带代码的描述</h4>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">swagger</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;2.0&#39;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">info</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">version</span><span class="p">:</span><span class="w"> </span><span class="m">1.1.0</span><span class="w">
</span><span class="w">  </span><span class="k">title</span><span class="p">:</span><span class="w"> </span>Simple<span class="w"> </span>API<span class="w">
</span><span class="w">  </span><span class="k">description</span><span class="p">:</span><span class="w"> </span><span class="sd">|
</span><span class="sd">    A simple API to learn how to write OpenAPI Specification.</span><span class="w">
</span><span class="w">    </span>This<span class="w"> </span>file<span class="w"> </span>uses<span class="w"> </span>almost<span class="w"> </span>every<span class="w"> </span>single<span class="w"> </span>aspect<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span><span class="p">[</span>Open<span class="w"> </span>API<span class="w"> </span>Specification<span class="p">]</span>(https<span class="p">:</span>//openapis.org/).<span class="w">  
</span><span class="w">    </span>This<span class="w"> </span>API<span class="w"> </span>will<span class="w"> </span>use<span class="w"> </span>JSON.<span class="w">  
</span><span class="w">    </span><span class="k">JSON looks like this</span><span class="p">:</span><span class="w">  
</span><span class="w">
</span><span class="w">    </span>```JSON<span class="w">
</span><span class="w">    </span>{<span class="w">
</span><span class="w">      </span><span class="k">&#34;key&#34;: </span><span class="s2">&#34;value&#34;</span><span class="p">,</span><span class="w">
</span><span class="w">      </span><span class="k">&#34;anotherKey&#34;: </span><span class="s2">&#34;anotherValue&#34;</span><span class="w">
</span><span class="w">    </span>}<span class="w">
</span><span class="w">    
</span></code></pre></div><h3 id="示例数据examples">示例数据（Examples）</h3>
<p>我们已经知道了用Schema来描述参数和属性，有的时候，用示例数据更有表现了。我们可以使用关键字<code>example</code>来给原子属性或者对象添加示例数据。</p>
<h4 id="原子属性的示例数据">原子属性的示例数据</h4>
<div class="highlight"><pre class="chroma"><code class="language-YAML" data-lang="YAML"><span class="w">    </span><span class="k">properties</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">firstName</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>first<span class="w"> </span>name<span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">        </span><span class="k">example</span><span class="p">:</span><span class="w"> </span>John<span class="w">
</span><span class="w">      </span><span class="k">lastTimeOnline</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>The<span class="w"> </span>last<span class="w"> </span>time<span class="w"> </span>this<span class="w"> </span>person<span class="w"> </span>was<span class="w"> </span>connected<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>service<span class="w"> </span>as<span class="w"> </span>a<span class="w"> 
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">        </span><span class="k">format</span><span class="p">:</span><span class="w"> </span>date-time<span class="w">
</span><span class="w">        </span><span class="k">readOnly</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">        </span><span class="k">example</span><span class="p">:</span><span class="w"> </span><span class="ld">2016-06-10T12:36:58.014Z</span><span class="w">
</span><span class="w">
</span></code></pre></div><h4 id="对象属性的示例数据">对象属性的示例数据</h4>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">  </span><span class="k">Persons</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">title</span><span class="p">:</span><span class="w"> </span>Humans<span class="w">
</span><span class="w">    </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>A<span class="w"> </span>list<span class="w"> </span>of<span class="w"> </span>users<span class="w"> </span>or<span class="w"> </span>friends<span class="w">
</span><span class="w">    </span><span class="k">required</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- items<span class="w">
</span><span class="w">    </span><span class="k">properties</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">items</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Array<span class="w"> </span>containg<span class="w"> </span>the<span class="w"> </span>list<span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>array<span class="w">
</span><span class="w">        </span><span class="k">minItems</span><span class="p">:</span><span class="w"> </span><span class="m">10</span><span class="w">
</span><span class="w">        </span><span class="k">maxItems</span><span class="p">:</span><span class="w"> </span><span class="m">100</span><span class="w">
</span><span class="w">        </span><span class="k">uniqueItems</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">        </span><span class="k">items</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;#/definitions/Person&#39;</span><span class="w">
</span><span class="w">        </span><span class="k">example</span><span class="p">:</span><span class="w">
</span><span class="w">          </span>- <span class="k">firstname</span><span class="p">:</span><span class="w"> </span>Robert<span class="w">
</span><span class="w">            </span>lastname<span class="s2">&#34;: Doe
</span><span class="s2">            username&#34;</span><span class="p">:</span><span class="w"> </span>robdo<span class="w">
</span><span class="w">            </span><span class="k">dateOfBirth</span><span class="p">:</span><span class="w"> </span><span class="ld">1970-01-28</span><span class="w">
</span><span class="w">            </span><span class="k">lastTimeOnline</span><span class="p">:</span><span class="w"> </span><span class="ld">2016-04-10T14:36:58.014Z</span><span class="w">
</span><span class="w">          </span>- <span class="k">firstname</span><span class="p">:</span><span class="w"> </span>Jane<span class="w">
</span><span class="w">            </span><span class="k">lastname</span><span class="p">:</span><span class="w"> </span>Doe<span class="w">
</span><span class="w">            </span><span class="k">username</span><span class="p">:</span><span class="w"> </span>jdoe123<span class="w">
</span><span class="w">            </span><span class="k">dateOfBirth</span><span class="p">:</span><span class="w"> </span><span class="ld">1980-05-12</span><span class="w">
</span><span class="w">            </span><span class="k">lastTimeOnline</span><span class="p">:</span><span class="w"> </span><span class="ld">2016-05-12T19:23:59.014Z</span><span class="w">
</span><span class="w">
</span></code></pre></div><h4 id="定义的示例数据">定义的示例数据</h4>
<p>跟普通属性一样，定义的对象也能添加示例数据：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">  </span><span class="k">MultilingualErrorMessage</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">title</span><span class="p">:</span><span class="w"> </span>MultiLingualMultiDeviceErrorMessage<span class="w">
</span><span class="w">    </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>An<span class="w"> </span>multilingual<span class="w"> </span>error<span class="w"> </span>message<span class="w"> </span>(hashmap)<span class="w"> </span>with<span class="w"> </span>a<span class="w"> </span>long<span class="w"> </span>and<span class="w"> </span>a<span class="w"> </span>short<span class="w"> </span>description<span class="w">
</span><span class="w">    </span><span class="k">additionalProperties</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;#/definitions/ErrorMessage&#39;</span><span class="w">
</span><span class="w">    </span><span class="k">properties</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">defaultLanguage</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;#/definitions/ErrorMessage&#39;</span><span class="w">
</span><span class="w">    </span><span class="k">example</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">defaultLanguage</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">longMessage</span><span class="p">:</span><span class="w"> </span>We&#39;re<span class="w"> </span>deeply<span class="w"> </span>sorry<span class="w"> </span>but<span class="w"> </span>an<span class="w"> </span>error<span class="w"> </span>occured<span class="w">
</span><span class="w">        </span><span class="k">shortMessage</span><span class="p">:</span><span class="w"> </span>Error<span class="w">
</span><span class="w">      </span><span class="k">fr</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">longMessage</span><span class="p">:</span><span class="w"> </span>Nous<span class="w"> </span>sommes<span class="w"> </span>dÃ©solÃ©<span class="w"> </span>mais<span class="w"> </span>une<span class="w"> </span>erreur<span class="w"> </span>est<span class="w"> </span>survenu<span class="w">
</span><span class="w">        </span><span class="k">shortMessage</span><span class="p">:</span><span class="w"> </span>Erreur<span class="w">
</span><span class="w">
</span></code></pre></div><h4 id="响应消息的示例数据">响应消息的示例数据</h4>
<p>我们甚至可以添加响应消息级别的示例数据：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">  </span><span class="s1">&#39;/persons/{username}/collecting-items&#39;</span><span class="p">:</span><span class="w">
</span><span class="w">    </span>……<span class="w">
</span><span class="w">    </span><span class="k">get</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>……<span class="w">
</span><span class="w">      </span><span class="k">responses</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">&#39;200&#39;</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">examples</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="k">application/json</span><span class="p">:</span><span class="w">
</span><span class="w">              </span>{<span class="w">
</span><span class="w">                </span><span class="k">&#34;totalItems&#34;: </span><span class="m">10</span><span class="p">,</span><span class="w">
</span><span class="w">                </span><span class="k">&#34;totalPage&#34;: </span><span class="m">4</span><span class="p">,</span><span class="w">
</span><span class="w">                </span><span class="k">&#34;pageSize&#34;: </span><span class="m">3</span><span class="p">,</span><span class="w">
</span><span class="w">                </span><span class="k">&#34;currentPage&#34;: </span><span class="m">2</span><span class="p">,</span><span class="w">
</span><span class="w">                </span><span class="k">&#34;items&#34;: </span><span class="w">
</span><span class="w">                </span><span class="p">[</span><span class="w">
</span><span class="w">                  </span>{<span class="w"> 
</span><span class="w">                    </span><span class="k">&#34;itemType&#34;: </span><span class="s2">&#34;Vinyl&#34;</span><span class="p">,</span><span class="w">
</span><span class="w">                    </span><span class="k">&#34;maxPrice&#34;: </span><span class="m">20</span><span class="p">,</span><span class="w">
</span><span class="w">                    </span><span class="k">&#34;imageId&#34;: </span><span class="s2">&#34;98096838-04eb-4bac-b32e-cd5b7196de71&#34;</span><span class="p">,</span><span class="w">
</span><span class="w">                    </span><span class="k">&#34;albumName&#34;: </span><span class="s2">&#34;Captain Future Original Soundtrack&#34;</span><span class="p">,</span><span class="w">
</span><span class="w">                    </span><span class="k">&#34;artist&#34;: </span><span class="s2">&#34;Yuji Ohno&#34;</span><span class="w">
</span><span class="w">                  </span>}<span class="p">,</span><span class="w">
</span><span class="w">                  </span>{<span class="w"> 
</span><span class="w">                    </span><span class="k">&#34;itemType&#34;: </span><span class="s2">&#34;VHS&#34;</span><span class="p">,</span><span class="w">
</span><span class="w">                    </span><span class="k">&#34;maxPrice&#34;: </span><span class="m">10</span><span class="p">,</span><span class="w">
</span><span class="w">                    </span><span class="k">&#34;imageId&#34;: </span><span class="s2">&#34;b74469bc-e6a1-4a90-858a-88ef94079356&#34;</span><span class="p">,</span><span class="w">
</span><span class="w">                    </span><span class="k">&#34;movieTitle&#34;: </span><span class="s2">&#34;Star Crash&#34;</span><span class="p">,</span><span class="w">
</span><span class="w">                    </span><span class="k">&#34;director&#34;: </span><span class="s2">&#34;Luigi Cozzi&#34;</span><span class="w">
</span><span class="w">                  </span>}<span class="p">,</span><span class="w">
</span><span class="w">                  </span>{<span class="w"> 
</span><span class="w">                    </span><span class="k">&#34;itemType&#34;: </span><span class="s2">&#34;AudioCassette&#34;</span><span class="p">,</span><span class="w">
</span><span class="w">                    </span><span class="k">&#34;maxPrice&#34;: </span><span class="m">10</span><span class="p">,</span><span class="w">
</span><span class="w">                    </span><span class="k">&#34;imageId&#34;: </span><span class="s2">&#34;b74469bc-e6a1-4a90-858a-88ef94079356&#34;</span><span class="p">,</span><span class="w">
</span><span class="w">                    </span><span class="k">&#34;albumName&#34;: </span><span class="s2">&#34;Star Wars&#34;</span><span class="p">,</span><span class="w">
</span><span class="w">                    </span><span class="k">&#34;artist&#34;: </span><span class="s2">&#34;John Williams&#34;</span><span class="w">
</span><span class="w">                  </span>}<span class="w">
</span><span class="w">                </span><span class="p">]</span><span class="w">
</span><span class="w">              </span>}<span class="w">
</span><span class="w">        </span><span class="k">&#39;404&#39;</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;#/responses/PersonDoesNotExistResponse&#39;</span><span class="w">
</span><span class="w">        </span><span class="k">&#39;500&#39;</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;#/responses/Standard500ErrorResponse&#39;</span><span class="w">
</span><span class="w">        </span><span class="k">default</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;#/responses/TotallyUnexpectedResponse&#39;</span><span class="w">
</span><span class="w">
</span></code></pre></div><h4 id="示例数据的优先级">示例数据的优先级</h4>
<p>如果我们在各个级别（比如参数、对象、定义、响应消息）都添加了示例数据。支持OpenAPI规范的各解析工具<strong>都是</strong>以 <strong>最高级别</strong>的定义为准。</p>
<h3 id="标记为弃用">标记为弃用</h3>
<p>我们可以通过关键字<code>deprecated</code>置为 <em>true</em> 来标记接口的<strong>弃用</strong>状态，比如：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">  </span><span class="k">/js-less-consumer-persons</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;#/parameters/userAgent&#39;</span><span class="w">
</span><span class="w">    </span><span class="k">post</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">summary</span><span class="p">:</span><span class="w"> </span>Creates<span class="w"> </span>a<span class="w"> </span>person<span class="w">
</span><span class="w">      </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>For<span class="w"> </span>JS-less<span class="w"> </span>partners<span class="w">
</span><span class="w">      </span><span class="k">operationId</span><span class="p">:</span><span class="w"> </span>createUserJS<span class="w">
</span><span class="w">      </span><span class="k">deprecated</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">
</span></code></pre></div><h3 id="链接到外部文档">链接到外部文档</h3>
<p>一般来说，项目中不光只有一篇API文档，还应该有些描述application key，测试用例，操作链以及其他内容的文档，这些文档一般是单独成篇的。如果在描述某个接口时，我们想链接这些文档，可以通过关键字<code>externalDoc</code>来添加，例如：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">externalDocs</span><span class="p">:</span><span class="w"> 
</span><span class="w">  </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Complete<span class="w"> </span>documentation<span class="w"> </span>describing<span class="w"> </span>how<span class="w"> </span>to<span class="w"> </span>use<span class="w"> </span>this<span class="w"> </span>API<span class="w">
</span><span class="w">  </span><span class="k">url</span><span class="p">:</span><span class="w"> </span>http<span class="p">:</span>//doc.simple.api/<span class="w">
</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">  </span><span class="k">/images</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;#/parameters/userAgent&#39;</span><span class="w">
</span><span class="w">    </span><span class="k">post</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">summary</span><span class="p">:</span><span class="w"> </span>Uploads<span class="w"> </span>an<span class="w"> </span>image<span class="w">
</span><span class="w">      </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Upload<span class="w"> </span>an<span class="w"> </span>image<span class="p">,</span><span class="w"> </span>will<span class="w"> </span>return<span class="w"> </span>an<span class="w"> </span>image<span class="w"> </span>id.<span class="w"> 
</span><span class="w">      </span><span class="k">operationId</span><span class="p">:</span><span class="w"> </span>storeImage<span class="w">
</span><span class="w">      </span><span class="k">externalDocs</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>How<span class="w"> </span>to<span class="w"> </span>upload<span class="w"> </span>media<span class="w">
</span><span class="w">        </span><span class="k">url</span><span class="p">:</span><span class="w"> </span>http<span class="p">:</span>//doc.simple.api/media/upload<span class="w">
</span><span class="w">
</span></code></pre></div><hr>
<h2 id="第8章-分而治之">第8章 分而治之</h2>
<p>根据前面几张的知识，我们已经可以轻松的构建一个复杂的API文档了。可是作为一个学过 <em>Clean Code</em> 的程序员，我们并不希望所有的接口、定义都在一个<strong>大而全</strong>的上帝文件里。这一章我们一起来学习拆分文件。</p>
<h3 id="json指针">JSON指针</h3>
<p>我们在第2章已经知道了怎么定义一个可重用的对象，已经如何使用定义，重温一下：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">  </span>/persons/{<span class="k">username}</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">get</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">summary</span><span class="p">:</span><span class="w"> </span>Gets<span class="w"> </span>a<span class="w"> </span>person<span class="w">
</span><span class="w">      </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Returns<span class="w"> </span>a<span class="w"> </span>single<span class="w"> </span>person<span class="w"> </span>for<span class="w"> </span>its<span class="w"> </span>username.<span class="w">
</span><span class="w">      </span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">        </span>- <span class="k">name</span><span class="p">:</span><span class="w"> </span>username<span class="w">
</span><span class="w">          </span><span class="k">in</span><span class="p">:</span><span class="w"> </span>path<span class="w">
</span><span class="w">          </span><span class="k">required</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>The<span class="w"> </span>person&#39;s<span class="w"> </span>username<span class="w">
</span><span class="w">          </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">      </span><span class="k">responses</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">200</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>A<span class="w"> </span>Person<span class="w">
</span><span class="w">          </span><span class="k">schema</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#/definitions/Person&#34;</span><span class="w">
</span><span class="w">        </span><span class="k">404</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>The<span class="w"> </span>Person<span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exists.<span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">definitions</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">Person</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">required</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- username<span class="w">
</span><span class="w">    </span><span class="k">properties</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">firstName</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">      </span><span class="k">lastName</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">      </span><span class="k">username</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">  </span><span class="k">Persons</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>array<span class="w">
</span><span class="w">    </span><span class="k">items</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#/definitions/Person&#34;</span><span class="w">
</span><span class="w">
</span></code></pre></div><p>在使用的时候我们这样写：<em>$ref: &ldquo;#/definitions/Person&rdquo;</em> ，<code>$ref</code>就是<strong>JSON指针</strong>（参见定义<a href="https://tools.ietf.org/html/rfc6901">RFC6901</a>）。例子中的这个指针指向**当前文档根路径（#）**下的<em>definitions</em> 下的 <em>Person</em>。</p>
<p>JSON指针不仅可以指向当前文件，还可以指向其他文件。</p>
<h3 id="基础拆分">基础拆分</h3>
<h3 id="引用本地文件">引用本地文件</h3>
<p>还是上面这个例子，我们在当前文档的同一目录下，新建的一个文件叫 <code>person.yaml</code>，然后把<em>Person</em> 的定义拆出来，放在其中。</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">Person</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">required</span><span class="p">:</span><span class="w">
</span><span class="w">    </span>- username<span class="w">
</span><span class="w">  </span><span class="k">properties</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">firstName</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">    </span><span class="k">lastName</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">    </span><span class="k">username</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">
</span></code></pre></div><p>在当前文档中把引用 <em>Person</em> 定义的地方修改为：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;person.yaml#/Person&#34;</span><span class="w">
</span><span class="w">
</span></code></pre></div><h4 id="编辑器报错">编辑器报错</h4>
<p>把上面的代码放到Swagger Editor中编辑，编辑器预览中可能会报错：</p>
<p>提示找不到person.yaml文件。这是因为我们<strong>没有指定正确的编辑器的指针解析基础路径（Pointer Resolution Base Path）</strong>。</p>
<p>解决的办法是：进入编辑器的 <em>Preferences -&gt; Preferences 菜单</em>，修改<code>Pointer Resolution Base Path</code>为：</p>
<p>考虑到缓存的原因，如果错误依然存在，请刷新浏览器。</p>
<h4 id="文件夹">文件夹</h4>
<p>如果引用子文件夹下的文件，我们可以这样写：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">           </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;folder/person.yaml#/Person&#34;</span><span class="w">
</span><span class="w">
</span></code></pre></div><p>如果引用上级文件夹下的文件，我们可以这样写：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">Persons</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>array<span class="w">
</span><span class="w">  </span><span class="k">items</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;../folder/person.yaml#/Person&#34;</span><span class="w">
</span><span class="w">
</span></code></pre></div><h4 id="引用远程文件">引用远程文件</h4>
<p>如果我们想引用一个远程文件，应该怎么做呢？可以这样写：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">  </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span>https<span class="p">:</span>//myserver.com/mypath/myfile.yaml<span class="c">#/example</span><span class="w">
</span><span class="w">
</span></code></pre></div><p>但是需要注意的是：<strong>服务器必须提供跨域（CORS）访问服务</strong>。</p>
<p>如果要通过本地服务器上的8080端口引用文件，我们可以这样写：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">  </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;http://localhost:8080/folder/person.yaml#/Person&#34;</span><span class="w">
</span><span class="w">
</span></code></pre></div><p>考虑两种比较特别的情况：</p>
<h5 id="远端文件引用本地文件">远端文件引用&quot;本地文件&rdquo;</h5>
<p>比如说，我们引用了：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">  </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;http://localhost:8080/another-folder/persons.yaml#/Persons&#34;</span><span class="w">
</span></code></pre></div><p>这个远端文件。但是<code>persons.yaml</code>又引用了与它在同一目录下的<code>person.yaml</code>文件，这个时候语法分析器会在<code>localhost:8080</code>上面找<code>person.yaml</code>文件，而不会查找我们本地的<code>person.yaml</code>。</p>
<h5 id="远端文件引用-更远端文件">远端文件引用 ”更“远端文件</h5>
<p>如果理解了8.2.4.1这个例子，我们就知道不管怎么引用，都是在相对于被引用的文件下来进行查找的。</p>
<h4 id="整理一个文件中的多个定义">整理一个文件中的多个定义</h4>
<p>比如我们在一个文件中，需要把定义分成几类，可以这样做：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">SomeDefinitions</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">Person</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">required</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- username<span class="w">
</span><span class="w">    </span><span class="k">properties</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">firstName</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">      </span><span class="k">lastName</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">      </span><span class="k">username</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>string<span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">OtherDefinitions</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">Persons</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>array<span class="w">
</span><span class="w">    </span><span class="k">items</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#/SomeDefinitions/Person&#34;</span><span class="w">
</span><span class="w">
</span></code></pre></div><p><code>Person</code>归属于<code>SomeDefinitions</code>这一类，<code>Persons</code>归属于<code>OtherDefinitions</code>这一类。那么我们在引用这两个定义时，分别应该这样书写：</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">            </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;definitions.yaml#/OtherDefinitions/Persons&#34;</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">            </span><span class="k">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;definitions.yaml#/SomeDefinitions/Person&#34;</span><span class="w">
</span></code></pre></div><p>有点像<strong>命名空间</strong>的概念。</p>
<h3 id="实战切分的思路">实战切分的思路</h3>
<ul>
<li>结构化切分思路： 先把API文档的头部<code>info</code>切下来，放在<code>info.yaml</code>，然后分别切分 <code>paths.yaml</code>，<code>definitions.yaml</code>，<code>responses.yaml</code>，<code>parameters.yaml</code>等文件，最后合并到<code>main.yaml</code>；</li>
<li>分层切分思路：分别按照<strong>功能</strong>和<strong>层次</strong>，将文件切分为<code>base.yaml</code>或<code>common.yaml</code>，然后是各个模块的<code>xxx-paths.yaml</code>，然后是各个定义的<code>xxx-definitions.yaml</code>。</li>
<li>其他思路……</li>
</ul>
<p>需要注意的是，不管怎么切分，有一个原则必须谨记：</p>
<p><strong>切分出来的子文档，必须遵循OpenAPI规范，能够通过编辑器的校验，不然切分得再漂亮也是徒劳。</strong></p>
<h2 id="附录">附录</h2>
<p><a href="http://apihandyman.io/">Arnaud Lauret</a>大神为了简化OpenAPI规范的阅读，维护了一个<a href="https://github.com/arno-di-loreto/openapi-specification-visual-documentation"><strong>openapi-specification-visual-documentation</strong></a>的项目，通过动态导图的方式把规范完整呈现，懒人必备。点击<a href="http://openapi-specification-visual-documentation.apihandyman.io/">此处</a>查看。</p>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">子不语</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
        2019-09-05
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      
      <nav class="post-nav">
        <a class="prev" href="/2018/03/redis-%E9%85%8D%E7%BD%AE%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E9%80%9F%E6%9F%A5/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Redis 配置常用配置速查</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:hi@gitblog.me" class="iconfont icon-email" title="email"></a>
  <a href="http://localhost:1313/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://gohugo.io">Hugo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2017 - 
    2020
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">子不语</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.d7b7ada643c9c1a983026e177f141f7363b4640d619caf01d8831a6718cd44ea.js"></script>








</body>
</html>
